<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="在最前面：在AS中新建project 时，请勾上：  This project will support instant apps use androidx.* artifacts    避免版本依赖的问题">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 笔记">
<meta property="og:url" content="http://yoursite.com/2019/05/12/19-05-12-Android-%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="zhanyeye&#39;s learning log">
<meta property="og:description" content="在最前面：在AS中新建project 时，请勾上：  This project will support instant apps use androidx.* artifacts    避免版本依赖的问题">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/zhanyeye/Figure-bed/img/img/20190607101909.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zhanyeye/Figure-bed/img/img/20190607091106.png">
<meta property="og:image" content="https://raw.githubusercontent.com/zhanyeye/Figure-bed/img/img/20190607092539.png">
<meta property="article:published_time" content="2019-05-12T00:27:59.000Z">
<meta property="article:modified_time" content="2020-08-01T07:08:09.513Z">
<meta property="article:author" content="zhanyeye">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zhanyeye/Figure-bed/img/img/20190607101909.png">

<link rel="canonical" href="http://yoursite.com/2019/05/12/19-05-12-Android-%E7%AC%94%E8%AE%B0/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Android 笔记 | zhanyeye's learning log</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">zhanyeye's learning log</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">(^～^)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-01-UI"><span class="nav-number">1.</span> <span class="nav-text">Example 01 UI</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Relative-Layout-amp-Linear-Layout"><span class="nav-number">1.1.</span> <span class="nav-text">Relative Layout &amp; Linear Layout</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#ConstraintLayout"><span class="nav-number">1.2.</span> <span class="nav-text">ConstraintLayout</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-02-Common-Widgets"><span class="nav-number">2.</span> <span class="nav-text">Example 02 Common Widgets</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-03-UI-amp-Events"><span class="nav-number">3.</span> <span class="nav-text">Example 03 UI &amp; Events</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-04-App-Resources-amp-R"><span class="nav-number">4.</span> <span class="nav-text">Example 04 App Resources &amp; R</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-05-Activities"><span class="nav-number">5.</span> <span class="nav-text">Example 05 Activities</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Activities"><span class="nav-number">5.1.</span> <span class="nav-text">Activities</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Common-Intents"><span class="nav-number">5.2.</span> <span class="nav-text">Common Intents</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-06-RecyclerView"><span class="nav-number">6.</span> <span class="nav-text">Example 06  RecyclerView</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#create-RecyclerView"><span class="nav-number">6.1.</span> <span class="nav-text">create RecyclerView</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%9C%80%E6%B1%82OnItemClicklistener"><span class="nav-number">6.2.</span> <span class="nav-text">需求OnItemClicklistener</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#SwipeRefreshLayout"><span class="nav-number">6.3.</span> <span class="nav-text">SwipeRefreshLayout</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-07-ItemTouchHelper"><span class="nav-number">7.</span> <span class="nav-text">Example 07 ItemTouchHelper</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-08-Appbar-amp-Toolbar-amp-Menu"><span class="nav-number">8.</span> <span class="nav-text">Example 08 Appbar &amp; Toolbar &amp; Menu</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Appbar-amp-Toolbar"><span class="nav-number">8.1.</span> <span class="nav-text">Appbar &amp; Toolbar</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Menu"><span class="nav-number">8.2.</span> <span class="nav-text">Menu</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-09-Navigation-amp-BottomNavigationView"><span class="nav-number">9.</span> <span class="nav-text">Example 09 Navigation &amp; BottomNavigationView</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Fragment-amp-Navigation"><span class="nav-number">9.1.</span> <span class="nav-text">Fragment &amp; Navigation</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#BottomNavigationView"><span class="nav-number">9.2.</span> <span class="nav-text">BottomNavigationView</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-10-DrawerLayout-amp-NavigationView"><span class="nav-number">10.</span> <span class="nav-text">Example 10 DrawerLayout &amp; NavigationView</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-11-SharedPreferences-%E6%8E%A5%E5%8F%A3"><span class="nav-number">11.</span> <span class="nav-text">Example 11 SharedPreferences 接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-12-DataBinding-amp-ViewModel-amp-LiveData"><span class="nav-number">12.</span> <span class="nav-text">Example 12 DataBinding &amp; ViewModel &amp; LiveData</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%9F%BA%E4%BA%8Emainactivity"><span class="nav-number">12.1.</span> <span class="nav-text">基本实现，基于mainactivity</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%95%B4%E5%90%88recycleview%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%9F%BA%E4%BA%8Esecactivity"><span class="nav-number">12.2.</span> <span class="nav-text">整合recycleview的实现，基于secactivity</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Two-way-data-binding"><span class="nav-number">12.3.</span> <span class="nav-text">Two-way data binding</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-13-Connecting-to-the-Network"><span class="nav-number">13.</span> <span class="nav-text">Example 13 Connecting to the Network</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Network-Request-Response-amp-Image-Resources"><span class="nav-number">13.1.</span> <span class="nav-text">Network Request&#x2F;Response &amp; Image Resources</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Databinding-amp-ViewModel-amp-BindingAdapter"><span class="nav-number">13.2.</span> <span class="nav-text">Databinding &amp; ViewModel &amp; BindingAdapter</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Post-Request"><span class="nav-number">13.3.</span> <span class="nav-text">Post Request</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-14-Room"><span class="nav-number">14.</span> <span class="nav-text">Example 14 Room</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Query"><span class="nav-number">14.1.</span> <span class="nav-text">Query</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Insert-amp-Snackbar"><span class="nav-number">14.2.</span> <span class="nav-text">Insert   &amp; Snackbar</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-15-External-Storage"><span class="nav-number">15.</span> <span class="nav-text">Example 15 External Storage</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Internal-Storage"><span class="nav-number">15.1.</span> <span class="nav-text">Internal Storage</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#External-Storage"><span class="nav-number">15.2.</span> <span class="nav-text">External Storage</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-16-Dialogs"><span class="nav-number">16.</span> <span class="nav-text">Example 16 Dialogs</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-17-Capture-amp-Gallery"><span class="nav-number">17.</span> <span class="nav-text">Example 17 Capture &amp; Gallery</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-18-Notification"><span class="nav-number">18.</span> <span class="nav-text">Example 18 Notification</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-19-Service"><span class="nav-number">19.</span> <span class="nav-text">Example 19 Service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Example-20-BroadcastReceiver"><span class="nav-number">20.</span> <span class="nav-text">Example 20 BroadcastReceiver</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zhanyeye</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhanyeye" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhanyeye" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/05/12/19-05-12-Android-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhanyeye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhanyeye's learning log">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android 笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-12 08:27:59" itemprop="dateCreated datePublished" datetime="2019-05-12T08:27:59+08:00">2019-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-01 15:08:09" itemprop="dateModified" datetime="2020-08-01T15:08:09+08:00">2020-08-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%93%E4%B8%9A%E8%AF%BE/" itemprop="url" rel="index"><span itemprop="name">专业课</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>在最前面：<br>在AS中新建project 时，请勾上：</p>
<ul>
<li>This project will support instant apps</li>
<li><code>use androidx.* artifacts</code>    避免版本依赖的问题</li>
</ul>
<a id="more"></a>

<h5 id="Example-01-UI"><a href="#Example-01-UI" class="headerlink" title="Example 01 UI"></a>Example 01 UI</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example01/src/main/res/layout/activity_main.xml">link</a></p>
<blockquote>
<p>dp，像素密度，设备屏幕尺寸无关的，描述控件间距离等    (记：device)<br>sp，描述<strong>字体</strong>大小    (记：script)<br>px，像素，相对的绝对单元，与CSS相似等，图片等  (记：Pixel)</p>
</blockquote>
<p>RelativeLayout: 相对布局<br>LinearLayout: 线性布局<br>ConstraintLayout: 约束布局</p>
<h6 id="Relative-Layout-amp-Linear-Layout"><a href="#Relative-Layout-amp-Linear-Layout" class="headerlink" title="Relative Layout &amp; Linear Layout"></a>Relative Layout &amp; Linear Layout</h6><p>Linear与Relative布局的区别: 如果层级多的使用RelativeLayout<br><img src="https://raw.githubusercontent.com/zhanyeye/Figure-bed/img/img/20190607101909.png"></p>
<p>LinearLayout 主要属性</p>
<ul>
<li>android:orientation，LinearLayout方向<br><code>vertical</code> ,  <code>horizontal</code></li>
<li>android:layout_gravity，<strong>相对于</strong>该控件的<strong>父组件</strong>，控件本身的显示位置。仅在LinearLayout内有效，受android:orientation属性影响<br><code>bottom</code> , <code>center</code></li>
<li>android:gravity，<strong>控件内</strong>内容的显示位置</li>
<li>android:layout_weight，比重，android:orientation <strong>相应方向的值需设为0dp</strong><br><code>android:layout_width=&quot;0dp&quot;   android:layout_weight=&quot;1&quot;</code></li>
</ul>
<h6 id="ConstraintLayout"><a href="#ConstraintLayout" class="headerlink" title="ConstraintLayout"></a>ConstraintLayout</h6><p>它的出现主要是为了解决布局嵌套过多的问题 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/17ec9bd6ca8a">link</a></p>
<p>添加依赖 : 在app/build.gradle文件中添加ConstraintLayout的依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;com.android.support.constraint:constraint-layout:1.1.3&#39;</span><br></pre></td></tr></table></figure>

<p>与Relative的区别：<strong>仅对相同位置/方向进行相对的约束</strong><br><img src="https://raw.githubusercontent.com/zhanyeye/Figure-bed/img/img/20190607091106.png"></p>
<p><img src="https://raw.githubusercontent.com/zhanyeye/Figure-bed/img/img/20190607092539.png"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>  <span class="attr">...</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;TextView_A&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout_editor_absoluteX</span>=<span class="string">&quot;189dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout_editor_absoluteY</span>=<span class="string">&quot;253dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textView2&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;TextView_B&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginBottom</span>=<span class="string">&quot;56dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@+id/textView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout_editor_absoluteX</span>=<span class="string">&quot;280dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textView3&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;TextView_C&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginBottom</span>=<span class="string">&quot;72dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;@+id/textView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout_editor_absoluteX</span>=<span class="string">&quot;101dp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-02-Common-Widgets"><a href="#Example-02-Common-Widgets" class="headerlink" title="Example 02 Common Widgets"></a>Example 02 Common Widgets</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example02/src/main/res/layout/activity_main.xml">link</a></p>
<p>android:id属性，声明组件ID; 后端可以通过ID值获取组件对象</p>
<ul>
<li>@+id，创建一个新ID</li>
<li>@id，引用一个ID</li>
<li>@，引用资源</li>
<li>@android:，引用android下自带资源</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/textView1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:text</span>=<span class="string">&quot;基本文本显示&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/imageView&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:srcCompat</span>=<span class="string">&quot;@android:drawable/ic_input_add&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>基本输入组件： Buttons；Text Fields；CheckBoxes；Radio Buttons；Toggle Buttons；ImageView；EditText</p>
<p>other: imageview; progressBar; Seekbar; RatingBar;</p>
<hr>
<h5 id="Example-03-UI-amp-Events"><a href="#Example-03-UI-amp-Events" class="headerlink" title="Example 03 UI &amp; Events"></a>Example 03 UI &amp; Events</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example03/src/main/java/com/example/example03/MainActivity.java">link</a></p>
<blockquote>
<p>后端仅基于ID名称获取组件，无法基于不同布局文件区分组件ID，也无法区分组件类型。<br>调用到不是当前布局上组件，运行时才能发现错误。<br>因此，ID的名称必须能够体现具体的完整的信息，从而避免出错。<br>较好的命名方法 : 布局类型 _ 布局名称 _ 组件类型 _ 组件名称: <code>act_main_editText_username</code></p>
</blockquote>
<p><code>findViewById()</code> : 基于ID名称获取组件</p>
<p><strong>Android中Callback的设计与使用 ? 理解掌握2种实现监听的方法?</strong></p>
<ul>
<li>匿名内部类</li>
<li>lambda表达式 (set language level to 8)</li>
</ul>
<p><code>View.OnClickListener: onClick()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//onCreate()中</span></span><br><span class="line">buttonSubmit = findViewById(R.id.act_main_button_submit);</span><br><span class="line"><span class="comment">//匿名内部类</span></span><br><span class="line">buttonSubmit.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        String string = editTextUserName.getText().toString();</span><br><span class="line">        textViewUserName.setText(string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//lambda表达式</span></span><br><span class="line">buttonSubmit.setOnClickListener(v -&gt; &#123;</span><br><span class="line">    String string = editTextUserName.getText().toString();</span><br><span class="line">    textViewUserName.setText(string);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>EditText: TextChangedListener </code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//onCreate()中</span></span><br><span class="line">editTextNameChange = findViewById(R.id.act_main_editText_change);</span><br><span class="line"><span class="comment">//匿名内部类</span></span><br><span class="line">editTextNameChange.addTextChangedListener(<span class="keyword">new</span> TextWatcher() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, <span class="keyword">int</span> after)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        textViewNamechange.setText(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>View.OnLongClickListener: onLongClick()</code><br><code>View.OnFocusChangeListener: onFocusChange()</code><br><code>View.OnTouchListener: onTouch()</code><br><code>View.OnKeyListener: onKey()</code></p>
<p>…</p>
<hr>
<h5 id="Example-04-App-Resources-amp-R"><a href="#Example-04-App-Resources-amp-R" class="headerlink" title="Example 04 App Resources &amp; R"></a>Example 04 App Resources &amp; R</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example04/src/main/res">link</a></p>
<p><strong>各文件目录放置的资源?</strong></p>
<ul>
<li>drawable : 图片相关的xml文件 (若图标有固定的尺寸，不需要更改，那么drawable更适合)</li>
<li>minmap :  图片相关的xml文件   (如果需要变大变小的，有动画的，放在mipmap中能有更高的质量)</li>
<li>Layout : 布局文件</li>
<li>value : 用于存放显示相的配置数据的定义文件，如strings.xml, style.xml, dimens.xml, arrays.xml, ids.xml等</li>
</ul>
<p><strong>R.java的作用与意义 ?</strong></p>
<ul>
<li>R.java文件自动生成，用来定义Android程序中所有各类型的资源的索引</li>
<li>在java程序中引用资源 <code>R.resource_type.resource_name</code></li>
<li>在XML文件中引用资源 <code>@[package:]type/name</code><br>@drawable/icon<br>@ 代表的是R.java类<br><code>drawable</code> 代表的是<code>R.java</code>中的静态内部类 <code>drawable</code><br><code>/icon</code>代表静态内部类 <code>drawable</code> 中的静态属性 <code>icon</code><br>如果访问的是Android系统中自带的文件，则要添加包名“Android:” <code>android:textColor=&quot;@android:color/red&quot;</code></li>
<li>往R.java文件中添加一条资源记录<br>为组件添加Id属性作为标识:<code>@id+/name</code></li>
</ul>
<p>自定义资源文件，创建字符串数组资源，添加ListView，引入自定义字符串数组至ListView显示</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">自定义资源文件 mysource.xml</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">&quot;courses&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>C语言<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>Java语言<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>数据库原理<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>计算机网络<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"></span><br><span class="line">布局文件 activity_main.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">ListView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:entries</span>=<span class="string">&quot;@array/courses&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ListView</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>定义字符串数组资源，并在代码中通过R调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button = findViewById(R.id.act_main_button);</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/topics/resources/overview.html">Resources Overview</a><br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/topics/resources/providing-resources.html">Providing Resources</a><br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/topics/resources/accessing-resources.html">Accessing Resources</a><br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/topics/resources/available-resources.html">Resource Types</a></p>
<hr>
<h5 id="Example-05-Activities"><a href="#Example-05-Activities" class="headerlink" title="Example 05 Activities"></a>Example 05 Activities</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example05/src/main/java/com/example/example05">link</a></p>
<h6 id="Activities"><a href="#Activities" class="headerlink" title="Activities"></a>Activities</h6><blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/components/activities.html"><code>Activity</code></a>是一个应用组件，用户可与其提供的屏幕进行交互（相当于一个页面）<br>每个 Activity 都会获得一个用于绘制其用户界面的窗口。<br>窗口通常会充满屏幕，但也可小于屏幕并浮动在其他窗口之上</p>
</blockquote>
<blockquote>
<p>一个应用通常由多个彼此松散联系的 Activity 组成。 一般会指定应用中的某个 Activity 为“主”Activity，即首次启动应用时呈现给用户的那个 Activity。 而且每个 Activity 均可启动另一个 Activity，以便执行不同的操作。 每次新 Activity 启动时，前一 Activity 便会停止，但系统会在堆栈（“返回栈”）中保留该 Activity。 当新 Activity 启动时，系统会将其推送到返回栈上，并取得用户焦点。 返回栈遵循基本的“后进先出”堆栈机制，因此，当用户完成当前 Activity 并按“返回”按钮时，系统会从堆栈中将其弹出（并销毁），然后恢复前一 Activity。</p>
</blockquote>
<p><strong>Declare Activities</strong></p>
<p>使用activity 需要在 <code>manifest</code> 配置中声明: 在 <code>&lt;application&gt;</code> 添加1个 <code>&lt;activity&gt;</code> 元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest ... &gt;</span><br><span class="line">  &lt;application ... &gt;</span><br><span class="line">      &lt;activity android:name&#x3D;&quot;.ExampleActivity&quot; &#x2F;&gt;</span><br><span class="line">      ...</span><br><span class="line">  &lt;&#x2F;application ... &gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;&#x2F;manifest &gt;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>回调方法</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>onCreate()</td>
<td>系统会在创建 Activity 时调用此方法. <br />实现内初始化 Activity 的数据 .<br />必须在 setContentView() 中定义 Activity 所使用的的layout文件.<br />onCreate() 完成后 下一步 就是 onStart().</td>
</tr>
<tr>
<td>onStart()</td>
<td>As <code>onCreate()</code> exits, the activity enters the Started state.<br />the activity becomes visible to the user.<br />This callback contains the activity’s final preparations for coming to the foreground and becoming interactive.</td>
</tr>
<tr>
<td>onPause()</td>
<td>when the activity loses focus and enters a Paused state.<br />the activity will soon enter the <strong>Stopped</strong> or <strong>Resumed</strong> state.<br />may continue to update the UI if the user is expecting the UI to update (a media player playing).</td>
</tr>
<tr>
<td>onStop()</td>
<td>when the activity is no longer visible to the user<br />may happen because the activity is being destroyedd, a new activity is starting, or an existing activity is entering a Resumed state and is covering the stopped activity<br />next callback that the system calls is either <code>onRestart()</code>  or  <code>onDestroy()</code></td>
</tr>
<tr>
<td>onRestart()</td>
<td>when an activity in the Stopped state is about to restart<br />restores(恢复) the state of the activity from the time that it was stopped<br />This callback is always followed by <code>onStart()</code></td>
</tr>
<tr>
<td>onDestroy()</td>
<td>invokes this callback before an activity is destroyed<br />ensure that all of an activity’s resources are released</td>
</tr>
</tbody></table>
<h6 id="Common-Intents"><a href="#Common-Intents" class="headerlink" title="Common Intents"></a>Common <a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/components/intents-common.html">Intents</a></h6><p>Intent在Android中的核心作用就是“跳转”,同时可以携带必要的信息，将Intent作为一个信息桥梁</p>
<ol>
<li><p>explicit intent : 显示跳转到下一个活动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class);  //上下文环境； 目的Activity</span><br><span class="line">startActivity(intent);   <span class="comment">//startActivity方法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>传递数据 : <code>intent.putExtra(key, value)</code> 上一个活动向下一个活动传递数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//在第一个页面将数据装进Intent</span></span><br><span class="line">   intent.putExtra(<span class="string">&quot;extra_data&quot;</span>, <span class="string">&quot;dafadfadfa&quot;</span>);   <span class="comment">//键值对</span></span><br><span class="line"><span class="comment">//在第二个页面拿到数据</span></span><br><span class="line">   getIntent().getStringExtra(<span class="string">&quot;extra_data&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>implicit intent : specifies an action that can invoke any app on the device able to perform the action</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the text message with a string</span></span><br><span class="line">Intent sendIntent = <span class="keyword">new</span> Intent();</span><br><span class="line">sendIntent.setAction(Intent.ACTION_SEND);</span><br><span class="line">sendIntent.putExtra(Intent.EXTRA_TEXT, textMessage);</span><br><span class="line">sendIntent.setType(<span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify that the intent will resolve to an activity</span></span><br><span class="line"><span class="keyword">if</span> (sendIntent.resolveActivity(getPackageManager()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">    startActivity(sendIntent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong>Starting an Activity</strong><br>内容：Activity的切换方法；切换时前后Activity经历的生命周期过程；通过Intent在跳转切换时传递参数；Bundle；<br>要求：实现全部生命周期回调函数，在跳转时观察activity的状态，传递并接收参数。</p>
<p><strong>知识点1</strong>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/markshz/article/details/80762818">实现<code>OnClickListener</code>接口的三种方法</a></p>
<ol>
<li><p>创建内部类    <del>（麻烦）</del></p>
<blockquote>
<p>创建一个内部类实现OnClickListener接口并重写onClick方法</p>
</blockquote>
</li>
<li><p>主类中实现OnClickListener接口: </p>
<blockquote>
<p>在主类中实现OnClickListener接口并重写onClick方法<br>button.setOnClickListener(this);</p>
</blockquote>
</li>
<li><p>匿名内部类:</p>
<blockquote>
<p>当按钮较少或只有一个按钮时，可以直接创建OnClickListener的匿名内部类传入按钮的setOnClickListener参数中</p>
</blockquote>
</li>
</ol>
<p><strong>知识点2</strong>：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dazuihou/p/3565647.html">super.onCreate(savedInstanceState)</a></p>
<ol>
<li><p>onCreate()方法其实是覆写了基类（Activity类）的onCreate方法，super.onCreate()是在调用基类中的onCreate方法。</p>
<blockquote>
<p>而在子类的onCreate方法中，不能直接调用onCreate(),因为这样做会产生递归，为了解决这一问题，java用super关键字表示超类的意思，当前类就是从超类继承而来的</p>
</blockquote>
</li>
<li><p>savedInstanceState是保存当前Activity的状态信息</p>
<blockquote>
<p>如果一个非running的Activity因为资源紧张而被系统销毁，当再次启动这个Activity时，可以通过这个保存下来的状态实例，即通过saveInstanceState获取之前的信息，然后使用这些信息，让用户感觉和之前的界面一模一样，提升用户体验。</p>
</blockquote>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainActivity类中实现OnClickListener接口，并重写 OnClick() 方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> EditText editText;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState); <span class="comment">//保存当前Activity的状态信息</span></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onCreate()&quot;</span>);</span><br><span class="line">        setContentView(R.layout.activity_main);  <span class="comment">//放置UI布局</span></span><br><span class="line">        button = findViewById(R.id.act_main_button);</span><br><span class="line">        editText = findViewById(R.id.act_main_edittext);</span><br><span class="line"></span><br><span class="line">        button.setOnClickListener(<span class="keyword">this</span>); <span class="comment">//为什么用this???</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.act_main_button:</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecActivity.class);</span><br><span class="line">                intent.putExtra(<span class="string">&quot;value&quot;</span>, editText.getText().toString()); <span class="comment">//以键值对传值</span></span><br><span class="line">                startActivity(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;SecActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView textView;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_sec);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;SecActivity onCreate()&quot;</span>);</span><br><span class="line">        String value = getIntent().getStringExtra(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        textView = findViewById(R.id.act_sec_textview);</span><br><span class="line">        textView.setText(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;SecActivity onStart()&quot;</span>);</span><br><span class="line">        <span class="comment">// The activity is about to become visible.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;SecActivity onResume()&quot;</span>);</span><br><span class="line">        <span class="comment">// The activity has become visible (it is now &quot;resumed&quot;).</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;SecActivity onPause()&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        <span class="comment">// Another activity is taking focus (this activity is about to be &quot;paused&quot;).</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;SecActivity onStop()&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        <span class="comment">// The activity is no longer visible (it is now &quot;stopped&quot;)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;SecActivity onDestroy()&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        <span class="comment">// The activity is about to be destroyed.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-06-RecyclerView"><a href="#Example-06-RecyclerView" class="headerlink" title="Example 06  RecyclerView"></a>Example 06  <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4f9591291365">RecyclerView</a></h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example06/src/main/java/com/example/example06">link</a></p>
<blockquote>
<p>The views in the list are represented by <em>view holder</em>(视图持有者) objects. These objects are instances of a class you define by extending <code>RecyclerView.ViewHolder</code>. Each view holder is in charge of displaying a single item with a view.<br>The <code>RecyclerView</code>creates only as many view holders as are needed to display the on-screen portion of the dynamic content, plus a few extra. As the user scrolls through the list, the <code>RecyclerView</code> takes the off-screen views and rebinds them to the data which is scrolling onto the screen.</p>
</blockquote>
<h6 id="create-RecyclerView"><a href="#create-RecyclerView" class="headerlink" title="create RecyclerView"></a>create RecyclerView</h6><p>配置：在对应的 <code>build.gradle</code>   文件中dependencies加上   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;androidx.recyclerview:recyclerview:1.0.0&#39;</span><br></pre></td></tr></table></figure>

<p>创建RecyclerView中<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example06/src/main/res/layout/recyclerview_news.xml">item布局样式</a></p>
<p>创建实体类news封装数据  </p>
<blockquote>
<p>实体类属性 public ?     :谷歌虚拟机没有使用内联，减少损耗   故不建议使用 get/set ， 直接public</p>
</blockquote>
<p>创建自定义adapter</p>
<ul>
<li><p>在adapter中创建viewholder (在Adapter中创建一个<strong>继承RecyclerView.ViewHolder</strong>的静态内部类，记为VH)</p>
</li>
<li><p>adapter添加news集合属性, 添加有参构造函数</p>
</li>
<li><p>adapter继承RecyclerView.Adapter，并声明VH泛型为自定义的VH类型</p>
</li>
<li><p>在<strong>Adapter中实现3个方法</strong></p>
<ol>
<li><p><strong>onCreateViewHolder()</strong></p>
<blockquote>
<p>这个方法主要<strong>生成</strong>为<strong>每个Item <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cdc9d4c0826e?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation">inflater</a>出一个View</strong>，但是该方法<strong>返回</strong>的是一个<strong>ViewHolder</strong>。该方法把View直接封装在ViewHolder中，然后我们面向的是ViewHolder这个实例，当然这个ViewHolder需要我们自己去编写</p>
</blockquote>
</li>
<li><p><strong>onBindViewHolder()</strong></p>
<blockquote>
<p>这个方法主要用于<strong>适配渲染数据到View</strong>中。方法<strong>提供</strong>给你了一<strong>viewHolder</strong>而不是原来的convertView</p>
</blockquote>
</li>
<li><p><strong>getItemCount()</strong></p>
<blockquote>
<p>这个方法就<strong>类似</strong>于BaseAdapter的<strong>getCount</strong>方法了，即总共有多少个条目。</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<p>重写getItemCount()方法返回集合元素数量，即需要渲染的item数量<br>重写onBindViewHolder()方法，当视图item滚动，绑定对应数据到item中的相应控件<br>重写onCreateViewHolder()方法，声明item布局样式，并将view item对象，交由viewholder持有<br>RecyclerView默认不包含点击事件及点击动画，需手动实现  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">MainAdapter</span>.<span class="title">MyViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainAdapter&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;News&gt; news;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainAdapter</span><span class="params">(List&lt;News&gt; news)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.news = news;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基于指定样式，渲染item，并将item对象绑定到viewholder</span></span><br><span class="line"><span class="comment">     * 当回收缓存区没有VH时，回调</span></span><br><span class="line"><span class="comment">     * 基于布局创建item对象，创建VH封装item对象，返回VH以复用</span></span><br><span class="line"><span class="comment">     * 因此，仅会回调有限次数。不同系统版本，不同屏幕尺寸等等均不同</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parent</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyViewHolder <span class="title">onCreateViewHolder</span><span class="params">(<span class="meta">@NonNull</span> ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onCreateViewHolder&quot;</span>);</span><br><span class="line">        <span class="comment">// 每一个item对象</span></span><br><span class="line">        <span class="comment">//将一个xml布局文件转换成一个View</span></span><br><span class="line">        View itemView = LayoutInflater.from(parent.getContext())</span><br><span class="line">                .inflate(R.layout.recyclerview_news, parent, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// 由VM持有</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyViewHolder(itemView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当渲染指定位置item时，从回收缓存区注入一个相同布局类型的VH，以及item的位置</span></span><br><span class="line"><span class="comment">     * 从vm中获取持有的控件对象，将指定集合位置的数据加载到控件，渲染</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> holder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> position</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(<span class="meta">@NonNull</span> MyViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onBindViewHolder: &quot;</span> + position + <span class="string">&quot;/&quot;</span> + news.get(position).title);</span><br><span class="line">        holder.title.setText(news.get(position).title);</span><br><span class="line">        holder.suttitle.setText(news.get(position).subtitle);</span><br><span class="line">        <span class="comment">// 模拟图片</span></span><br><span class="line">        holder.pic.setImageResource(R.mipmap.ic_launcher);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 必须指定初始化时item数量，后期可动态改变</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> news.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * VH的作用是保持item view上的控件对象的引用</span></span><br><span class="line"><span class="comment">     * 避免在复用item上反复findViewById</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        TextView title;</span><br><span class="line">        TextView suttitle;</span><br><span class="line">        ImageView pic;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyViewHolder</span><span class="params">(<span class="meta">@NonNull</span> View itemView)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(itemView);</span><br><span class="line">            title = itemView.findViewById(R.id.news_title);</span><br><span class="line">            suttitle = itemView.findViewById(R.id.news_subtitle);</span><br><span class="line">            pic = itemView.findViewById(R.id.news_pic);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>RecyclerView提供了<strong>三种布局管理器</strong>：</p>
<ul>
<li><strong>LinerLayoutManager</strong> 以<strong>垂直</strong>或者<strong>水平列表</strong>方式展示Item</li>
<li><strong>GridLayoutManager</strong> 以<strong>网格</strong>方式展示Item</li>
<li><strong>StaggeredGridLayoutManager</strong> 以<strong>瀑布流</strong>方式展示Item</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RecyclerView recyclerView;</span><br><span class="line">    <span class="keyword">private</span> MainAdapter adapter;</span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        recyclerView = findViewById(R.id.act_main_recyclerview);</span><br><span class="line">        <span class="comment">// 指定一个默认的布局管理器</span></span><br><span class="line">        RecyclerView.LayoutManager mLayoutManager = <span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>);</span><br><span class="line">        recyclerView.setLayoutManager(mLayoutManager);</span><br><span class="line">        <span class="comment">// 指定item插入/移除动画</span></span><br><span class="line">        <span class="comment">// recyclerView.setItemAnimator(new DefaultItemAnimator());</span></span><br><span class="line">        <span class="comment">// 指定item分割线</span></span><br><span class="line">        recyclerView.addItemDecoration(<span class="keyword">new</span> DividerItemDecoration(<span class="keyword">this</span>, LinearLayoutManager.VERTICAL));</span><br><span class="line">        <span class="comment">// 指定适配器</span></span><br><span class="line">        adapter = <span class="keyword">new</span> MainAdapter(listNews());</span><br><span class="line">        recyclerView.setAdapter(adapter);</span><br><span class="line"></span><br><span class="line">        button = findViewById(R.id.act_main_button);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, SecActivity.class);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;News&gt; <span class="title">listNews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        News n1 = <span class="keyword">new</span> News(<span class="number">1</span>, <span class="string">&quot;阿根廷VS波黑&quot;</span>, <span class="string">&quot;小组赛F组 阿根廷VS波黑&quot;</span>);</span><br><span class="line">        News n2 = <span class="keyword">new</span> News(<span class="number">2</span>, <span class="string">&quot;法国VS洪都拉斯&quot;</span>, <span class="string">&quot;小组赛E组 法国VS洪都拉斯&quot;</span>);</span><br><span class="line">        News n3 = <span class="keyword">new</span> News(<span class="number">3</span>, <span class="string">&quot;瑞士VS厄瓜多尔&quot;</span>, <span class="string">&quot;小组赛E组 瑞士VS厄瓜多尔&quot;</span>);</span><br><span class="line">        News n4 = <span class="keyword">new</span> News(<span class="number">4</span>, <span class="string">&quot;西班牙VS荷兰&quot;</span>, <span class="string">&quot;小组赛B组 西班牙VS荷兰&quot;</span>);</span><br><span class="line">        News n5 = <span class="keyword">new</span> News(<span class="number">5</span>, <span class="string">&quot;俄罗斯VS丹麦&quot;</span>, <span class="string">&quot;小组赛A组 俄罗斯VS丹麦&quot;</span>);</span><br><span class="line">        News n6 = <span class="keyword">new</span> News(<span class="number">6</span>, <span class="string">&quot;巴西VS意大利&quot;</span>, <span class="string">&quot;小组赛C组 巴西VS意大利&quot;</span>);</span><br><span class="line">        News n7 = <span class="keyword">new</span> News(<span class="number">7</span>, <span class="string">&quot;日本VS伊朗&quot;</span>, <span class="string">&quot;小组赛D组 日本VS伊朗&quot;</span>);</span><br><span class="line">        List&lt;News&gt; news = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        news.add(n1); news.add(n2); news.add(n3); news.add(n4);</span><br><span class="line">        news.add(n5); news.add(n6); news.add(n7);</span><br><span class="line">        news.add(n1); news.add(n2); news.add(n3); news.add(n4);</span><br><span class="line">        <span class="keyword">return</span> news;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h6 id="需求OnItemClicklistener"><a href="#需求OnItemClicklistener" class="headerlink" title="需求OnItemClicklistener"></a>需求OnItemClicklistener</h6><ul>
<li>在item布局样式中添加点击波纹动画  </li>
<li>在adapter onBindViewHolder()方法为item view设置点击监听  </li>
<li>高级，自定义接口，实现在activity等的点击监听</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//在RecyclerView.xml根元素加上属性：添加点击波纹动画  </span><br><span class="line">android:background=&quot;?android:attr/selectableItemBackground&quot;</span><br><span class="line">android:clickable=&quot;true&quot;</span><br><span class="line">android:focusable=&quot;true&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在适配器中，自定义监听接口,实现在activity等的点击监听</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnItemClickListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(View view, <span class="keyword">int</span> position, News news)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//onBindViewHolder()方法为item view设置点击监听 </span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(<span class="meta">@NonNull</span> ViewHolder holder, <span class="keyword">final</span> <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    holder.title.setText(news.get(position).title);</span><br><span class="line">    holder.suttitle.setText(news.get(position).subtitle);</span><br><span class="line">    holder.pic.setImageResource(R.mipmap.ic_launcher);</span><br><span class="line">    holder.itemView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(context, news.get(position).title, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现在activity等的点击监听</span></span><br><span class="line"><span class="comment">//在onCreate()中：</span></span><br><span class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent i = <span class="keyword">new</span> Intent(SecActivity.<span class="keyword">this</span>, ThirdActivity.class);</span><br><span class="line">        startActivity(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h6 id="SwipeRefreshLayout"><a href="#SwipeRefreshLayout" class="headerlink" title="SwipeRefreshLayout"></a>SwipeRefreshLayout</h6><ul>
<li>添加下拉刷新功能，将RecyclerView嵌入<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example06/src/main/res/layout/activity_third.xml">SwipeRefreshLayout</a>  </li>
<li>通过Handler模拟耗时操作，添加元素  </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//将RecyclerView嵌入SwipeRefreshLayout </span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.swiperefreshlayout.widget.SwipeRefreshLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/act_third_swipe&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.recyclerview.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/act_third_recyclerview&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.swiperefreshlayout.widget.SwipeRefreshLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过Handler模拟耗时操作，<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example06/src/main/java/com/example/example06/ThirdActivity.java">添加元素</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> SwipeRefreshLayout swipe;</span><br><span class="line">swipe = findViewById(R.id.act_third_swipe);</span><br><span class="line">swipe.setOnRefreshListener(<span class="keyword">new</span> SwipeRefreshLayout.OnRefreshListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//模拟耗时操作，子线程禁止直接修改主线程控件属性</span></span><br><span class="line">        <span class="keyword">new</span> Handler().postDelayed(() -&gt; &#123;</span><br><span class="line">            <span class="comment">//取消刷新动画</span></span><br><span class="line">            swipe.setRefreshing(<span class="keyword">false</span>);</span><br><span class="line">            news.add(<span class="number">0</span>, <span class="keyword">new</span> News(<span class="number">1</span>, <span class="string">&quot;阿根廷VS波黑&quot;</span> + news.size(), <span class="string">&quot;小组赛F组 阿根廷VS波黑&quot;</span>));</span><br><span class="line">            adapter.notifyDataSetChanged(); <span class="comment">//通知适配器数据改变</span></span><br><span class="line">            &#125;, <span class="number">2000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-07-ItemTouchHelper"><a href="#Example-07-ItemTouchHelper" class="headerlink" title="Example 07 ItemTouchHelper"></a>Example 07 ItemTouchHelper</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example07/src/main/java/com/example/example07/adapter">link</a></p>
<p>ItemTouchHelper，用来协助处理RecyclerView中item的移动/滑动/拖拽等操作  </p>
<blockquote>
<p>Callback内部类(非回调接口)，继承实现各种操作<br>重写getMovementFlags()方法，决定拖拽滑动在哪个方向是被允许<br>重写onSwiped()方法，Item横向滑动时回调，删除item<br>DefaultItemAnimator类定义recyclerView item操作动画<br>adapter添加/移除item必须通过notifyItemInserted()/notifyItemRemoved()方法，才有动画互交效果<br>重写onSwiped()方法可删除item，但无法删除数据，通过自定义回调接口实现<br>依然通过SwipeRefreshLayout下拉刷新</p>
</blockquote>
<p>ItemTouchHelper<a target="_blank" rel="noopener" href="https://blog.csdn.net/u014133119/article/details/80942932#commentBox">使用步骤</a>：</p>
<blockquote>
<p>自定义callback继承 ItemTouchHelper.Callback -&gt; 在内部写一个数据操作接口 -&gt; 重写触发方法调用接口 -&gt; 适配器实现数据操作接口，重新方法 -&gt; acctivity 中附着 recyclerview</p>
</blockquote>
<ol>
<li><p>创建 <code>MyCallback</code> 继承 <code>ItemTouchHelper.Callback</code> </p>
</li>
<li><p>把数据操作部分抽象成一个接口 <code>AdapterCallback</code>,这个接口可以写在 <code>MyCallback</code> 内</p>
<blockquote>
<p>因为<code>ItemTouchHelper</code>在完成触摸的各种动作后，就要对<code>Adapter</code>的数据进行操作，比如侧滑删除操作</p>
</blockquote>
</li>
<li><p>自定义 adapter 实现接口<code>MyCallback.AdapterCallback</code>, 重写相关方法</p>
</li>
<li><p>在<code>MainActivity</code>中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ItemTouchHelper helper = <span class="keyword">new</span> ItemTouchHelper(<span class="keyword">new</span> MyCallback(adapter));</span><br><span class="line">helper.attachToRecyclerView(recyclerView);</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>具体实现：</p>
<p>MyCallback 及内部接口 AdapterCallback</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyCallback 及内部接口 AdapterCallback</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallback</span> <span class="keyword">extends</span> <span class="title">ItemTouchHelper</span>.<span class="title">Callback</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MyCallback&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> AdapterCallback adapterCallback;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AdapterCallback</span> </span>&#123; <span class="comment">//数据操作接口</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyCallback</span><span class="params">(AdapterCallback adapterCallback)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.adapterCallback = adapterCallback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该方法返回一个整数，用来指定拖拽和滑动在哪个方向是被允许的。</span></span><br><span class="line"><span class="comment">     * 在其中使用makeMovementFlags(int dragFlags, int swipeFlags)返回，</span></span><br><span class="line"><span class="comment">     * 该方法第一个参数用来指定拖动，第二个参数用来指定滑动。</span></span><br><span class="line"><span class="comment">     * ItemTouchHelper.UP  //滑动拖拽向上方向</span></span><br><span class="line"><span class="comment">     * ItemTouchHelper.DOWN//向下</span></span><br><span class="line"><span class="comment">     * ItemTouchHelper.LEFT//向左</span></span><br><span class="line"><span class="comment">     * ItemTouchHelper.RIGHT//向右</span></span><br><span class="line"><span class="comment">     * ItemTouchHelper.START//依赖布局方向的水平开始方向</span></span><br><span class="line"><span class="comment">     * ItemTouchHelper.END//依赖布局方向的水平结束方向</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> recyclerView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewHolder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMovementFlags</span><span class="params">(<span class="meta">@NonNull</span> RecyclerView recyclerView, <span class="meta">@NonNull</span> RecyclerView.ViewHolder viewHolder)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Log.i(TAG, &quot;&quot; + &quot;getMovementFlags&quot;);</span></span><br><span class="line">        <span class="comment">//允许上下的拖动</span></span><br><span class="line">        <span class="keyword">int</span> dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN;</span><br><span class="line">        <span class="comment">//只允许从右向左侧滑</span></span><br><span class="line">        <span class="keyword">int</span> swipeFlags = ItemTouchHelper.LEFT;</span><br><span class="line">        <span class="keyword">return</span> makeMovementFlags(<span class="number">0</span>, swipeFlags);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * onMove方法是拖拽的回调，参数viewHolder是拖动的Item，target是拖动的目标位置的Item,</span></span><br><span class="line"><span class="comment">     * 该方法如果返回true表示切换了位置，反之返回false。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> recyclerView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewHolder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMove</span><span class="params">(<span class="meta">@NonNull</span> RecyclerView recyclerView, <span class="meta">@NonNull</span> RecyclerView.ViewHolder viewHolder, <span class="meta">@NonNull</span> RecyclerView.ViewHolder target)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * onSwiped方法为Item滑动回调，viewHolder为滑动的item，direction为滑动的方向。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewHolder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> direction</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSwiped</span><span class="params">(<span class="meta">@NonNull</span> RecyclerView.ViewHolder viewHolder, <span class="keyword">int</span> direction)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (direction) &#123;</span><br><span class="line">            <span class="keyword">case</span> ItemTouchHelper.LEFT:</span><br><span class="line">                adapterCallback.remove(viewHolder.getAdapterPosition());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>自定义适配器并实现操作接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义适配器并实现操作接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">MainAdapter</span>.<span class="title">MyViewHolder</span>&gt; <span class="keyword">implements</span> <span class="title">MyCallback</span>.<span class="title">AdapterCallback</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainAdapter&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;News&gt; news;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainAdapter</span><span class="params">(List&lt;News&gt; news)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.news = news;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyViewHolder <span class="title">onCreateViewHolder</span><span class="params">(<span class="meta">@NonNull</span> ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        View itemView = LayoutInflater.from(parent.getContext())</span><br><span class="line">                .inflate(R.layout.recyclerview_news, parent, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyViewHolder(itemView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(<span class="meta">@NonNull</span> MyViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        holder.title.setText(news.get(position).title);</span><br><span class="line">        holder.suttitle.setText(news.get(position).subtitle);</span><br><span class="line">        holder.pic.setImageResource(R.mipmap.ic_launcher);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> news.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        news.remove(position);</span><br><span class="line">        <span class="comment">// 指定通知可提高渲染效率，同时支持动画</span></span><br><span class="line">        notifyItemRemoved(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        TextView title;</span><br><span class="line">        TextView suttitle;</span><br><span class="line">        ImageView pic;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MyViewHolder</span><span class="params">(<span class="meta">@NonNull</span> View itemView)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(itemView);</span><br><span class="line">            title = itemView.findViewById(R.id.news_title);</span><br><span class="line">            suttitle = itemView.findViewById(R.id.news_subtitle);</span><br><span class="line">            pic = itemView.findViewById(R.id.news_pic);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>MainActivity配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainActivity&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> RecyclerView recyclerView;</span><br><span class="line">    <span class="keyword">private</span> MainAdapter adapter;</span><br><span class="line">    <span class="keyword">private</span> SwipeRefreshLayout swipe;</span><br><span class="line">    <span class="keyword">private</span> List&lt;News&gt; news = listNews();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        recyclerView = findViewById(R.id.act_main_recyclerview);</span><br><span class="line">        <span class="comment">// 指定一个默认的布局管理器</span></span><br><span class="line">        RecyclerView.LayoutManager mLayoutManager = <span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>);</span><br><span class="line">        recyclerView.setLayoutManager(mLayoutManager);</span><br><span class="line">        <span class="comment">// 指定item插入/移除动画</span></span><br><span class="line">        DefaultItemAnimator animator = <span class="keyword">new</span> DefaultItemAnimator();</span><br><span class="line">        <span class="comment">// 包含默认的操作动画事件，也可自定义动画时间</span></span><br><span class="line">        animator.setRemoveDuration(<span class="number">500</span>);</span><br><span class="line">        animator.setMoveDuration(<span class="number">500</span>);</span><br><span class="line">        recyclerView.setItemAnimator(animator);</span><br><span class="line">        <span class="comment">// 指定item分割线</span></span><br><span class="line">        recyclerView.addItemDecoration(<span class="keyword">new</span> DividerItemDecoration(<span class="keyword">this</span>, LinearLayoutManager.VERTICAL));</span><br><span class="line">        <span class="comment">// 指定适配器</span></span><br><span class="line">        adapter = <span class="keyword">new</span> MainAdapter(news);</span><br><span class="line">        recyclerView.setAdapter(adapter);</span><br><span class="line"></span><br><span class="line">        ItemTouchHelper helper = <span class="keyword">new</span> ItemTouchHelper(<span class="keyword">new</span> MyCallback(adapter));</span><br><span class="line">        helper.attachToRecyclerView(recyclerView);</span><br><span class="line"></span><br><span class="line">        swipe = findViewById(R.id.act_third_swipe);</span><br><span class="line">        swipe.setOnRefreshListener(<span class="keyword">new</span> SwipeRefreshLayout.OnRefreshListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//模拟耗时操作，子线程禁止直接修改主线程控件属性</span></span><br><span class="line">                <span class="keyword">new</span> Handler().postDelayed(() -&gt; &#123;</span><br><span class="line">                    <span class="comment">//取消刷新动画</span></span><br><span class="line">                    swipe.setRefreshing(<span class="keyword">false</span>);</span><br><span class="line">                    news.add(<span class="number">0</span>, <span class="keyword">new</span> News(<span class="number">1</span>, <span class="string">&quot;阿根廷VS波黑&quot;</span> + news.size(), <span class="string">&quot;小组赛F组 阿根廷VS波黑&quot;</span>));</span><br><span class="line">                    <span class="comment">// 指定通知可提高渲染效率，同时支持动画</span></span><br><span class="line">                    adapter.notifyItemInserted(<span class="number">0</span>);</span><br><span class="line">                    recyclerView.scrollToPosition(<span class="number">0</span>);</span><br><span class="line">                &#125;, <span class="number">500</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;News&gt; <span class="title">listNews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;News&gt; news = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        News n1 = <span class="keyword">new</span> News(<span class="number">1</span>, <span class="string">&quot;阿根廷VS波黑&quot;</span>, <span class="string">&quot;小组赛F组 阿根廷VS波黑&quot;</span>);</span><br><span class="line">        News n2 = <span class="keyword">new</span> News(<span class="number">2</span>, <span class="string">&quot;法国VS洪都拉斯&quot;</span>, <span class="string">&quot;小组赛E组 法国VS洪都拉斯&quot;</span>);</span><br><span class="line">        News n3 = <span class="keyword">new</span> News(<span class="number">3</span>, <span class="string">&quot;瑞士VS厄瓜多尔&quot;</span>, <span class="string">&quot;小组赛E组 瑞士VS厄瓜多尔&quot;</span>);</span><br><span class="line">        news.add(n1); news.add(n2); news.add(n3);</span><br><span class="line">        <span class="keyword">return</span> news;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-08-Appbar-amp-Toolbar-amp-Menu"><a href="#Example-08-Appbar-amp-Toolbar-amp-Menu" class="headerlink" title="Example 08 Appbar &amp; Toolbar &amp; Menu"></a>Example 08 Appbar &amp; Toolbar &amp; Menu</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example08/src/main">link</a></p>
<h6 id="Appbar-amp-Toolbar"><a href="#Appbar-amp-Toolbar" class="headerlink" title="Appbar &amp; Toolbar"></a>Appbar &amp; Toolbar</h6><blockquote>
<p>欲使用功能丰富的appbar/toolbar，需先关闭android自带的title/actionbar<br>自定义无title/actionbar样式的主题<br>在AndroidManifest配置中引入自定义主题<br>自定义独立的appbar布局文件，注意命名空间<br>在activity layout中引入(类似JSP的include)<br>在activity中获取toolbar对象，可动态修改各种属性<br>动态置于ActionBar，开启左箭头(可选)等等  </p>
</blockquote>
<p>自定义无title/actionbar样式的主题 : res/values/styles.xml 中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 自定义无title/actionbar样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AppTheme.NoActionBar&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;windowNoTitle&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;windowActionBar&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example08/src/main/AndroidManifest.xml">AndroidManifest</a>配置中引入自定义主题: </p>
<p><code>android:theme=&quot;@style/AppTheme.NoActionBar&quot;&gt;</code></p>
<p>自定义独立的appbar布局文件，注意命名空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">----&gt;&gt; appbar.xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">com.google.android.material.appbar.AppBarLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.appcompat.widget.Toolbar</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/my_toolbar&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">androidx.appcompat.widget.Toolbar</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">com.google.android.material.appbar.AppBarLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在activity layout中引入(类似JSP的include)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">----&gt;&gt; activity_main.xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">&quot;@layout/appbar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在activity中获取toolbar对象，可动态修改各种属性<br>动态置于ActionBar，开启左箭头(可选)等等  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Toolbar toolbar = findViewById(R.id.my_toolbar);</span><br><span class="line">        <span class="comment">// 动态修改toolbar属性</span></span><br><span class="line">        toolbar.setLogo(R.mipmap.ic_launcher);</span><br><span class="line">        toolbar.setTitle(<span class="string">&quot;标题&quot;</span>);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        <span class="comment">// 显示左箭头</span></span><br><span class="line">        getSupportActionBar().setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    ...    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Menu"><a href="#Menu" class="headerlink" title="Menu"></a>Menu</h6><p>创建menu资源目录; 创建menu布局文件; 设置item title，icon等属性: <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example08/src/main/res/menu/menu.xml">link</a></p>
<ul>
<li>app:showAsAction属性: always, collapseActionView, ifRoom, never, withText</li>
</ul>
<p>重写activity onCreateOptionsMenu()方法，加载menu布局 <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example08/src/main/java/com/example/example08/MainActivity.java">link</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重写，加载menu布局</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> menu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">    getMenuInflater().inflate(R.menu.menu, menu);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重写activity onOptionsItemSelected()方法，监听item点击事件 <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example08/src/main/java/com/example/example08/MainActivity.java">link</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重写，监听menu点击事件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> item</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">    String msg = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span> (item.getItemId()) &#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_add:</span><br><span class="line">            msg = <span class="string">&quot;add&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">// 点击左箭头，返回，即关闭当前activity</span></span><br><span class="line">        <span class="keyword">case</span> android.R.id.home:</span><br><span class="line">            msg = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">            finish();</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_send:</span><br><span class="line">            msg = <span class="string">&quot;send&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_edit:</span><br><span class="line">            msg = <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.menu_del:</span><br><span class="line">            msg = <span class="string">&quot;delete&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-09-Navigation-amp-BottomNavigationView"><a href="#Example-09-Navigation-amp-BottomNavigationView" class="headerlink" title="Example 09 Navigation &amp; BottomNavigationView"></a>Example 09 Navigation &amp; BottomNavigationView</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example09/src/main">link</a></p>
<h6 id="Fragment-amp-Navigation"><a href="#Fragment-amp-Navigation" class="headerlink" title="Fragment &amp; Navigation"></a>Fragment &amp; Navigation</h6><blockquote>
<p>在module gradle配置引入navigation-fragment，navigation-ui依赖<br>(不直接声明依赖，创建导航视图文件时也可自动引入，但AS会卡住假死)<br>创建多个Fragment及布局<br>创建navigation资源目录，创建nav_graph导航视图文件<br>在导航视图中引入fragment，声明导航规则<br>(也可设置fragment的独立global action)<br>修改activity_main布局，添加NavHostFragment容器，，引用导航视图，声明必须属性   </p>
</blockquote>
<p>引入依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def nav_version &#x3D; &quot;2.0.0&quot;</span><br><span class="line">implementation &quot;androidx.navigation:navigation-fragment:$nav_version&quot;</span><br><span class="line">implementation &quot;androidx.navigation:navigation-ui:$nav_version&quot;</span><br></pre></td></tr></table></figure>

<p>创建多个Fragment及布局</p>
<blockquote>
<p>new -&gt; fragment -&gt; 勾选 Create Layout XML; 下面的2个include 选项不要勾选 (在创建 fragment 类的同时 创建布局文件)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FoodFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;FoodFragment&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></span><br><span class="line"><span class="function"><span class="params">                             Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment_food, container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//fragment中组件初始化写在 onViewCreated() 中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewCreated</span><span class="params">(<span class="meta">@NonNull</span> View view, <span class="meta">@Nullable</span> Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class="line">        Button button = view.findViewById(R.id.frag_food_detail_button);</span><br><span class="line">        button.setOnClickListener(v -&gt; &#123;</span><br><span class="line">            Navigation.findNavController(v).navigate(R.id.action_foodFragment_to_foodDetailFragment);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>创建navigation资源目录，创建nav_graph<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example09/src/main/res/navigation/nav_graph.xml">导航视图文件</a></p>
<blockquote>
<p>在导航视图中引入fragment，声明导航规则 : <strong>设置指定的id 导航到指定的 fragment类 和 它的布局</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_graph&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">&quot;@id/foodFragment&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/foodFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.example.example09.FoodFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;fragment_food&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">&quot;@layout/fragment_food&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/action_foodFragment_to_foodDetailFragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:destination</span>=<span class="string">&quot;@id/foodDetailFragment&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/foodDetailFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.example.example09.FoodDetailFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;fragment_food_detail&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">&quot;@layout/fragment_food_detail&quot;</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example09/src/main/res/layout/activity_main.xml">activity_main布局</a>，添加NavHostFragment容器，，引用导航视图，声明必须属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> //activity_main</span><br><span class="line"><span class="comment">&lt;!-- 声明一个NavHostFragment容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/my_nav_host_fragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:defaultNavHost</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:navGraph</span>=<span class="string">&quot;@navigation/nav_graph&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>



<h6 id="BottomNavigationView"><a href="#BottomNavigationView" class="headerlink" title="BottomNavigationView"></a>BottomNavigationView</h6><blockquote>
<p>com.google.android.material.bottomnavigation.BottomNavigationView<br>(自动包含选中状态样式：图标加亮+显示字体，区别未选中其他item)<br>创建menu文件，声明Navigation所需item，图标及文字，绑定Navigation中的fragment<br>在activity布局声明引入底部导航BottomNavigationView控件，引用menu<br>在activity中获取NavController对象及并绑定BottomNavigationView对象</p>
</blockquote>
<p>创建menu文件，声明Navigation所需item，图标及文字，绑定Navigation中的fragment</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-------&gt;&gt; menu_bottom_nav.xml</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@id/foodFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;Food&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/food_u&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@id/hotelFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;Hotel&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/hotel_u&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@id/mapFragment&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;Map&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_loc_in_map_u&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/menu_bottom_list&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:title</span>=<span class="string">&quot;List&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/main_index_my_pressed&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example09/src/main/res/layout/activity_main.xml">activity布局</a>声明引入底部导航BottomNavigationView控件，引用menu</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.google.android.material.bottomnavigation.BottomNavigationView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/bottom_nav&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:menu</span>=<span class="string">&quot;@menu/menu_bottom_nav&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example09/src/main/java/com/example/example09/MainActivity.java">Activity类</a>中获取NavController对象及并绑定BottomNavigationView对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">NavController</span>.<span class="title">OnDestinationChangedListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> NavController controller;</span><br><span class="line">    <span class="keyword">private</span> BottomNavigationView bottomNavigationView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        bottomNavigationView = findViewById(R.id.bottom_nav);</span><br><span class="line">        controller = Navigation.findNavController(<span class="keyword">this</span>, R.id.my_nav_host_fragment);</span><br><span class="line">        <span class="comment">// 监听导航切换事件</span></span><br><span class="line">        controller.addOnDestinationChangedListener(<span class="keyword">this</span>);</span><br><span class="line">        NavigationUI.setupWithNavController(bottomNavigationView, controller);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestinationChanged</span><span class="params">(<span class="meta">@NonNull</span> NavController controller, <span class="meta">@NonNull</span> NavDestination destination, <span class="meta">@Nullable</span> Bundle arguments)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (destination.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.foodDetailFragment:</span><br><span class="line">                bottomNavigationView.setVisibility(View.GONE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                bottomNavigationView.setVisibility(View.VISIBLE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-10-DrawerLayout-amp-NavigationView"><a href="#Example-10-DrawerLayout-amp-NavigationView" class="headerlink" title="Example 10 DrawerLayout &amp; NavigationView"></a>Example 10 DrawerLayout &amp; NavigationView</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example10/src/main/res/layout">link</a></p>
<blockquote>
<p>基于DrawerLayout创建抽屉布局，从内向外逐层构建<br>引入com.google.android.material:material:1.0.0依赖<br>创建基本主内容布局，声明layout_behavior属性避免被appbar覆盖<br>可声明使用showIn属性，增加预览效果<br>创建appbar布局，声明toolbar，引入主内容布局(需声明使用noactionbar样式)<br>基于menu创建抽屉导航选项<br>基于DrawerLayout创建抽屉布局，引入appbar布局，NavigationView引用menu导航<br>可选创建抽屉头部布局，并引入到NavigationView属性(自定义了头部背景样式)<br>Activity代码中添加actionbar<br>监听navigationView OnNavigationItemSelectedListener<br>任意item被点击，关闭抽屉<br>抽屉与下导航，选一种作为app主布局即可  </p>
</blockquote>
<p>引入依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;com.google.android.material:material:1.0.0&#39;</span><br></pre></td></tr></table></figure>

<p>创建基本主内容布局，声明layout_behavior属性避免被appbar覆盖</p>
<blockquote>
<p>可声明使用showIn属性，增加预览效果 (预览该布局在外层layout中的效果)</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-------&gt;&gt; content.xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_behavior</span>=<span class="string">&quot;com.google.android.material.appbar.AppBarLayout$ScrollingViewBehavior&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:showIn</span>=<span class="string">&quot;@layout/appbar&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;左拉抽屉；单activity开发，用navfragmenthost替换&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建appbar布局，声明toolbar，引入主内容布局 (需在AndroidManifest.xml和style.xml声明使用AppTheme.NoActionBar样式)<br><code>&lt;include layout = &quot;&quot;&gt;</code>引入 content 布局</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">------&gt;&gt; appbar.xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:showIn</span>=<span class="string">&quot;@layout/activity_main&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.google.android.material.appbar.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">androidx.appcompat.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/my_toolbar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">com.google.android.material.appbar.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">&quot;@layout/content&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>基于<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example10/src/main/res/menu/menu_drawer.xml">menu创建抽屉导航选项</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">android:checkableBehavior</span>=<span class="string">&quot;single&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_camera&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;@android:drawable/ic_menu_camera&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">&quot;camera&quot;</span> /&gt;</span></span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:title</span>=<span class="string">&quot;Communicate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">menu</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_share&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:icon</span>=<span class="string">&quot;@android:drawable/ic_menu_share&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:title</span>=<span class="string">&quot;share&quot;</span> /&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            ...</span><br><span class="line">        <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>基于DrawerLayout创建抽屉布局，引入appbar布局，NavigationView引用menu导航  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">----&gt;&gt; menu_drawer.xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.drawerlayout.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawer_layout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:openDrawer</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span></span></span><br><span class="line"><span class="tag">        <span class="attr">layout</span>=<span class="string">&quot;@layout/appbar&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.google.android.material.navigation.NavigationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_view&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">&quot;start&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:headerLayout</span>=<span class="string">&quot;@layout/drawer_header&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:menu</span>=<span class="string">&quot;@menu/menu_drawer&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.drawerlayout.widget.DrawerLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可选创建抽屉头部布局，并引入到NavigationView属性(自定义了头部背景样式)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">----&gt;&gt; drawer_header.xml</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;176dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@drawable/side_nav_bar&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">&quot;bottom&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">&quot;16dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/imageView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:paddingTop</span>=<span class="string">&quot;8dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:srcCompat</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginVertical</span>=<span class="string">&quot;8dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;20sp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textStyle</span>=<span class="string">&quot;bold&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">&quot;@color/colorAccent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;主标题&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/textView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;副标题&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Activity代码中添加actionbar<br>监听navigationView OnNavigationItemSelectedListener<br>任意item被点击，关闭抽屉  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">NavigationView</span>.<span class="title">OnNavigationItemSelectedListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Toolbar toolbar;</span><br><span class="line">    <span class="keyword">private</span> DrawerLayout drawerLayout;</span><br><span class="line">    <span class="keyword">private</span> NavigationView navigationView;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        toolbar = findViewById(R.id.my_toolbar);</span><br><span class="line">        drawerLayout = findViewById(R.id.drawer_layout);</span><br><span class="line">        navigationView = findViewById(R.id.nav_view);</span><br><span class="line">        setSupportActionBar(toolbar);</span><br><span class="line">        <span class="comment">// 显示左箭头</span></span><br><span class="line">        getSupportActionBar().setDisplayHomeAsUpEnabled(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        navigationView.setNavigationItemSelectedListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onNavigationItemSelected</span><span class="params">(<span class="meta">@NonNull</span> MenuItem menuItem)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (menuItem.getItemId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.nav_camera:</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;camera&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        drawerLayout.closeDrawer(GravityCompat.START); <span class="comment">//任意item被点击，关闭抽屉  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-11-SharedPreferences-接口"><a href="#Example-11-SharedPreferences-接口" class="headerlink" title="Example 11 SharedPreferences 接口"></a>Example 11 SharedPreferences 接口</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example11/src/main/java/com/example/example11/util">link</a></p>
<blockquote>
<p>Saving Key-Value Sets:<br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/data-storage/shared-preferences">https://developer.android.google.cn/training/data-storage/shared-preferences</a><br>基本的保存键值对数据的实现<br>自定义application，暴露获取application对象的静态方法<br>修改AndroidManifest配置启动自定义application<br>创建SharedPreferences操作工具类<br>编写输入输出布局<br>在activity中将输入写入文件<br>重新进入应用，文本输出控件，显式上次持久化的数据  </p>
</blockquote>
<blockquote>
<p>SharedPreferences 需要上下文<br>使用： <code>getApplicationContext()</code> 拿</p>
</blockquote>
<p>自定义application，暴露获取application对象的静态方法 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyApplication instance;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyApplication <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        instance = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改AndroidManifest<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example11/src/main/AndroidManifest.xml">配置</a>启动自定义application<br><code>android:name=&quot;.util.MyApplication&quot;</code></p>
<p>创建SharedPreferences操作工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 有则直接使用，没有则创建名为为pre_my的XML配置文件</span></span><br><span class="line"><span class="comment"> * 位置data\data\packagename\shared_prefs</span></span><br><span class="line"><span class="comment"> * 声明使用范围</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SharedPreferencesUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SharedPreferences sf = create();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PRE_FILE = <span class="string">&quot;pre_my&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MYEDIT = <span class="string">&quot;myedit&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封装SharedPreferences的构建过程，对外仅暴露允许修改的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SharedPreferences <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MyApplication.getInstance()</span><br><span class="line">                .getSharedPreferences(PRE_FILE, Context.MODE_PRIVATE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putMyedit</span> <span class="params">(String myedit)</span> </span>&#123;</span><br><span class="line">        sf.edit().putString(MYEDIT, myedit).apply();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMyedit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sf.getString(MYEDIT, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在activity中将输入写入文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在Main_Activity.java 中</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    editText = findViewById(R.id.act_main_edittext);</span><br><span class="line">    textView = findViewById(R.id.act_main_textView);</span><br><span class="line">    button = findViewById(R.id.act_main_button);</span><br><span class="line">    <span class="comment">// 获取值，没有默认值为空</span></span><br><span class="line">    textView.setText(SharedPreferencesUtils.getMyedit());</span><br><span class="line"></span><br><span class="line">    button.setOnClickListener(v -&gt; &#123;</span><br><span class="line">        SharedPreferencesUtils.putMyedit(editText.getEditableText().toString());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-12-DataBinding-amp-ViewModel-amp-LiveData"><a href="#Example-12-DataBinding-amp-ViewModel-amp-LiveData" class="headerlink" title="Example 12 DataBinding &amp; ViewModel &amp; LiveData"></a>Example 12 DataBinding &amp; ViewModel &amp; LiveData</h5><p>复习完成 ​-&gt; ​<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example12/src/main/java/com/example/example12">link</a></p>
<p> 在项目gradle配置中，启动dataBinding</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataBinding &#123;</span><br><span class="line">        enabled = true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加整合了viewmodel livedata的依赖lifecycle-extensions</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def lifecycle_version &#x3D; &quot;2.0.0&quot;</span><br><span class="line">&#x2F;&#x2F; ViewModel and LiveData</span><br><span class="line">implementation &quot;androidx.lifecycle:lifecycle-extensions:$lifecycle_version&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>官方推荐一个activity对应绑定一个ViewModel</strong></li>
</ul>
<h6 id="基本实现，基于mainactivity"><a href="#基本实现，基于mainactivity" class="headerlink" title="基本实现，基于mainactivity"></a>基本实现，基于mainactivity</h6><p>创建实体类</p>
<p>创建自定义viewmodel类</p>
<p>声明 <code>页面数据绑定</code>/<code>生命周期绑定</code>的MutableLiveData类型数据</p>
<p>创建修改方法，在子线程中修改数据</p>
<ul>
<li><code>setValue()</code>  在主线程 中更新数据 </li>
<li><code>postValue()</code>  在子线程 中更新数据 : <strong>自动通知主线程修改</strong></li>
<li><code>getValue()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainViewModel&quot;</span>;</span><br><span class="line">    <span class="comment">// 将预在页面绑定的数据，声明为与页面生命周期绑定的MutableLiveData可变类型</span></span><br><span class="line">    <span class="comment">// 可以想象为一个能够绑定到视图页面的容器</span></span><br><span class="line">    <span class="keyword">public</span> MutableLiveData&lt;User&gt; userLiveData = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 必须声明的构造函数</span></span><br><span class="line"><span class="comment">     * 自动注入application对象，便于后期使用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span><span class="params">(<span class="meta">@NonNull</span> Application application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(application);</span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">&quot;BO&quot;</span>);</span><br><span class="line">        userLiveData.setValue(user); <span class="comment">//在主线程 中更新数据 </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在子线程中异步操作修改绑定数据，而非主线程</span></span><br><span class="line"><span class="comment">     * 因此必须使用postValue()方法，自动通知主线程修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                User u = userLiveData.getValue();</span><br><span class="line">                u.name = <span class="string">&quot;SUN&quot;</span>;</span><br><span class="line">                <span class="comment">// 也可重新重新创建一个user对象，置入</span></span><br><span class="line">                userLiveData.postValue(u);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改layout文件，添加数据绑定标签<code>&lt;data&gt;&lt;variable/&gt;&lt;/data&gt;</code></p>
<p>绑定自定义的ViewModel类</p>
<p>在控件，通过表达式绑定数据，或方法 </p>
<p>双向绑定 <code>@=&#123;&#125;</code></p>
<p><strong>对象中的属性改变时，更新不会通知</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;mianVM&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;com.example.example12.viewmodel.MainViewModel&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@&#123;mianVM.userLiveData.name&#125;&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- VM方法不能耦合view对象:vm 不能绑定组件，应为可能已经被销毁了 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;() -&gt; mianVM.change()&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;异步改变值&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 直接调用activity中的方法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;onButtonClick&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;To SecActivity&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改activity代码，获取自定义动态创建的binding对象，获取自定义viewmodel对象</p>
<p>将vm绑定到UI页面</p>
<p>将绑定数据绑定到activity生命周期</p>
<ul>
<li><p>Activity 的<code>onCreate()</code> 中基于layout文件生成绑定对象 (setContentView 删去)</p>
</li>
<li><p>绑定类会基于 layout 中生成的变量,自动生成 getter/setter 方法</p>
</li>
<li><p>绑定自定义的 ViewModel 类 ：<code>binding.setMianVM(mainViewModel);</code></p>
</li>
<li><p>将绑定数据，与当前activity生命周期绑定：<code>binding.setMianVM(mainViewModel);</code> 如，当数据改变时，且activity可见时，自动更新页面</p>
</li>
<li><p>activity有处理UI，跳转更新等操作，业务逻辑操作由vm负责</p>
<blockquote>
<p>vm 不能绑定组件，应为可能已经被销毁了</p>
</blockquote>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">// 取消默认调用setContentView()方法代码：设置该activity 要渲染的布局UI</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 必须先在layout中使用data标签声明变量</span></span><br><span class="line"><span class="comment">         * 才能基于layout文件的命名，动态自动生成ActivityMainBinding类</span></span><br><span class="line"><span class="comment">         * The Data Binding Library generates binding classes that are used to access the layout&#x27;s variables and views. </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ActivityMainBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_main);</span><br><span class="line">        <span class="comment">// 必须通过工具类获取VM对象，不能手动创建</span></span><br><span class="line">        MainViewModel mainViewModel = ViewModelProviders.of(<span class="keyword">this</span>).get(MainViewModel.class);</span><br><span class="line">        <span class="comment">// 基于layout中声明的变量，自动生成属性变量的getter/setter方法</span></span><br><span class="line">        binding.setMianVM(mainViewModel);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 将绑定数据，与当前activity生命周期绑定</span></span><br><span class="line"><span class="comment">         * 例如，当数据改变时，且activity可见时，自动更新页面</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        binding.setLifecycleOwner(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * activity有处理UI，跳转更新等操作，业务逻辑操作由vm负责</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onButtonClick: &quot;</span>);</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecActivity.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="整合recycleview的实现，基于secactivity"><a href="#整合recycleview的实现，基于secactivity" class="headerlink" title="整合recycleview的实现，基于secactivity"></a>整合recycleview的实现，基于secactivity</h6><p>创建<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/java/com/example/example12/entity/News.java">实体类</a>，创建<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/java/com/example/example12/viewmodel/SecViewModel.java">VM</a></p>
<p>创建更新可观测数据</p>
<p>初始化时，异步更新可观测数据</p>
<p>创建方法，异步更新可观测数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;SecViewModel&quot;</span>;</span><br><span class="line">    <span class="comment">// 模拟每次获取的新数据，不是加上旧的全部数据</span></span><br><span class="line">    <span class="keyword">public</span> MutableLiveData&lt;List&lt;News&gt;&gt; newsLoad = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecViewModel</span><span class="params">(<span class="meta">@NonNull</span> Application application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(application);</span><br><span class="line">        <span class="comment">// 加载的同时发出异步获取更新数据请求</span></span><br><span class="line">        initNews();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  模拟异步请求并获取最新的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initNews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                News n1 = <span class="keyword">new</span> News(<span class="number">1</span>, <span class="string">&quot;阿根廷VS波黑&quot;</span>, <span class="string">&quot;小组赛F组 阿根廷VS波黑&quot;</span>);</span><br><span class="line">                List&lt;News&gt; news = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                news.add(n1);</span><br><span class="line">                <span class="comment">// 将数据异步更新绑定</span></span><br><span class="line">                newsLoad.postValue(news);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadNews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                News n1 = <span class="keyword">new</span> News(<span class="number">1</span>, <span class="string">&quot;荷兰VS西班牙&quot;</span>, <span class="string">&quot;小组赛F组 荷兰VS西班牙&quot;</span>);</span><br><span class="line">                List&lt;News&gt; news = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                news.add(n1);</span><br><span class="line">                newsLoad.postValue(news);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建recycleview_item<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/res/layout/recyclerview_news.xml">布局</a>，绑定实体类中属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span> = <span class="string">&quot;news&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com....News&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/res/layout/activity_sec.xml">layout</a>，绑定VM，绑定VM中更新方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;secVM&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.example12.viewmodel.SecViewModel&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:context</span>=<span class="string">&quot;.SecActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">androidx.recyclerview.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/act_sec_recyclerview&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;() -&gt; secVM.loadNews()&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;更新&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;toThird&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;双向绑定&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>创建自定义<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/java/com/example/example12/adapter/SecAdapter.java">adapter</a>，初始化数据集合，重写基本方法</strong></p>
<p>创建viewholder</p>
<blockquote>
<p>viewholder不再holder控件，而是每一个itemview对应的binding对象<br>通过binding对象绑定集合中的数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RecyclerviewNewsBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewHolder</span><span class="params">(<span class="meta">@NonNull</span> View itemView, RecyclerviewNewsBinding binding)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line">        <span class="keyword">this</span>.binding = binding;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重写onCreateViewHolder()方法，动态创建数据绑定对象</p>
<blockquote>
<p>为每个item创建binding对象，复用</p>
</blockquote>
<p>修改viewholder hold绑定对象</p>
<blockquote>
<p>返回的 viewholder 基于绑定对象创建：<code>return new MyViewHolder(binding.getRoot(), binding);</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MyViewHolder <span class="title">onCreateViewHolder</span><span class="params">(<span class="meta">@NonNull</span> ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">    LayoutInflater layoutInflater = LayoutInflater.from(parent.getContext());</span><br><span class="line">    <span class="comment">// 为每个item创建binding对象，复用</span></span><br><span class="line">    RecyclerviewNewsBinding binding = DataBindingUtil.inflate(layoutInflater, R.layout.recyclerview_news, parent, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyViewHolder(binding.getRoot(), binding);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重写onBindViewHolder()方法，将当前viewholder的binding对象绑定对应的集合数据</p>
<blockquote>
<p>binding 对象的set方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(<span class="meta">@NonNull</span> MyViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">    holder.binding.setNews(currentNewsList.get(position));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/java/com/example/example12/adapter/SecAdapter.java">DiffUtil.Callback</a><br>自定义DiffUtil.Callback类，重写相关方法，实现更新adapter时的计算依据<br>adapter对外提供自己的更新方法<br>基于自定义Callback类，实现高效的，仅针对需更新项的，支持动画效果的，动态更新</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/java/com/example/example12/SecActivity.java">Activity</a><br>修改activity代码，获取binding/viewmodel对象，绑定生命周期等<br>初始化recycleview，adapter等<br>监听自定义viewmodel中的数据更新，等有更新时，调用adapter提供的更新方法，通知其更新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">       <span class="comment">// 监听MV中数据更新，注入结果</span></span><br><span class="line">       viewModel.newsLoad.observe(<span class="keyword">this</span>, news -&gt; &#123;</span><br><span class="line">               Log.i(TAG, <span class="string">&quot;onChanged&quot;</span>);</span><br><span class="line">               <span class="comment">// 将最新数据交由adapter渲染</span></span><br><span class="line">               adapter.updateNews(news);</span><br><span class="line">               <span class="comment">// 更新到顶部</span></span><br><span class="line">               recyclerView.scrollToPosition(<span class="number">0</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>





<h6 id="Two-way-data-binding"><a href="#Two-way-data-binding" class="headerlink" title="Two-way data binding"></a>Two-way data binding</h6><p><a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example12/src/main/res/layout/activity_third.xml">双向绑定</a>要比vue复杂。例如，封装在可观测数据内，数据的改变无法直接响应</p>
<p>双向绑定 <code>@=&#123;&#125;</code></p>
<hr>
<h5 id="Example-13-Connecting-to-the-Network"><a href="#Example-13-Connecting-to-the-Network" class="headerlink" title="Example 13 Connecting to the Network"></a>Example 13 Connecting to the Network</h5><p>复习完成 -&gt; <a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/tree/master/example13/src/main/java/com/example/example13">link</a></p>
<h6 id="Network-Request-Response-amp-Image-Resources"><a href="#Network-Request-Response-amp-Image-Resources" class="headerlink" title="Network Request/Response &amp; Image Resources"></a>Network Request/Response &amp; Image Resources</h6><p>添加请求权限</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在 AndroidManifest.xml 添加</span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建自定义application类，配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Application instance;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        instance = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Application <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------</span><br><span class="line">AndroidManifest.xml 中 application 的 android:name=<span class="string">&quot;.util.MyApplication&quot;</span></span><br></pre></td></tr></table></figure>

<p>Android 9以后，要求网络请求必须为HTTPS加密请求，不便于测试，创建配置关闭该功能  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">network-security-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base-config</span> <span class="attr">cleartextTrafficPermitted</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network-security-config</span>&gt;</span></span><br><span class="line">------------------------</span><br><span class="line">AndroidManifest.xml 中 application 的 android:networkSecurityConfig=&quot;@xml/network_security_config&quot;</span><br></pre></td></tr></table></figure>

<p>引入Retrofit框架依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation &#x27;com.squareup.retrofit2:converter-gson:2.5.0&#x27;</span><br><span class="line">implementation &#x27;com.squareup.retrofit2:retrofit:2.5.0&#x27;</span><br></pre></td></tr></table></figure>

<p>创建实体类</p>
<p>创建封装响应数据的DTO类  (data transfer object)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于从json字符串转成Java对象  </span></span><br><span class="line"><span class="comment"> * 属性名称必须与响应中属性名称完全相同，一个dto可对应多个响应</span></span><br><span class="line"><span class="comment"> * 没有对应属性，自动忽略</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> News news;</span><br><span class="line">    <span class="keyword">public</span> List&lt;News&gt; newsList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建网络请求接口，声明与后端对应的restful请求地址，图片资源请求处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后端将数据封装在Map转为json</span></span><br><span class="line"><span class="comment"> * 与基于弱类型JS的前端处理不同，由于无法确定Map中值的类型而无法反序列化数据</span></span><br><span class="line"><span class="comment"> * 因此，为返回的响应创建对应转换的DTO类型，响应数据封装在DTO对象属性中</span></span><br><span class="line"><span class="comment"> * 请求路径不能使用，/，开始，否则baseurl设置会无效，将直接向服务器根路径相对请求</span></span><br><span class="line"><span class="comment"> * 请求注解与springMVC相似</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NewsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET(&quot;news/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;NewsDTO&gt; <span class="title">getNews</span><span class="params">(<span class="meta">@Path(&quot;id&quot;)</span> <span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET(&quot;news&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;NewsDTO&gt; <span class="title">listNews</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 全局的图片下载，可声明在一个独立的接口，此处简化</span></span><br><span class="line"><span class="comment">     * 传入图片地址，响应返回图片封装在ResponseBody</span></span><br><span class="line"><span class="comment">     * 结合构造retrofit时的缓存策略，自动重用缓存图片</span></span><br><span class="line"><span class="comment">     * 可结合自定义bindingadapter使用，更简洁，耦合性更低</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">getBitmap</span><span class="params">(<span class="meta">@Url</span> String url)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 即使没有返回值，也必须封装一个空类型Void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@POST(&quot;news&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">post</span><span class="params">(<span class="meta">@Body</span> News n)</span></span>; <span class="comment">//Call&lt;Void&gt; post(@Body News n);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造封装retrofit对象，声明缓存，请求相对根路径，转换器，拦截器等配置</p>
<p>构造封装请求接口类型对象，并对外暴露</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 默认retrofit将请求的图片置于缓存，当向相同地址请求图片时，自动加载缓存的图片</span></span><br><span class="line">    <span class="comment">// 自动在data/data/应用包/cache下，创建缓存文件,10MB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OkHttpClient client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">            .cache(<span class="keyword">new</span> Cache(MyApplication.getInstance().getCacheDir(), <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>))</span><br><span class="line">            .build();</span><br><span class="line">    <span class="comment">// 基于OKhttp对象，自定义属性，构造retrofit对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            <span class="comment">// 本地测试不能使用localhost，使用本地IP</span></span><br><span class="line">            <span class="comment">// 根路径必须已，/，结束</span></span><br><span class="line">            <span class="comment">// .baseUrl(&quot;http://192.168.1.3:8080/api/&quot;)</span></span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.whyman.site/api/&quot;</span>) <span class="comment">//设置网络请求的Url地址</span></span><br><span class="line">            .client(client)</span><br><span class="line">            .addConverterFactory(GsonConverterFactory.create()) <span class="comment">//设置数据解析</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// retrofit自动创建接口的代理类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> NewsService <span class="title">getNewsService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(NewsService.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>小小知识点： <strong>Builder 设计模式</strong></p>
<ul>
<li>在类中加一个静态内部类</li>
<li>静态内部类中有public方法设置属性</li>
<li>最后build() 方法，返回外部的类的对象</li>
</ul>
<blockquote>
<p>Builder模式通常作为配置类的构建器将配置的构建和表示分离开来，同时也是将配置从目标类中隔离出来，避免作为过多的setter方法，并且隐藏内部的细节。Builder模式比较常见的实现形式是通过链式调用，这样使得代码更加简洁、易懂。缺点是，内部类与外部类相互引用，可能会导致内存消耗比较大，不过鉴于现在的手机内存来讲，这点几乎影响不大。</p>
</blockquote>
</li>
</ul>
<p>编写布局文件<br>监听事件，调用retrofit完成异步的网络请求，并将结果渲染到视图  </p>
<ul>
<li>像网络请求这种线程阻塞的操作，禁止在主线程中执行</li>
<li>enqueue()为异步方法，将请求任务加入应用全局异步请求队列</li>
<li>在异步子线程中获取响应对象，在主线程，回调结果。即onResponse()方法为主线程调用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainActivity&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> TextView textView;</span><br><span class="line">    <span class="keyword">private</span> ImageView imageView;</span><br><span class="line">    NewsService service = ServiceFactory.getNewsService();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button = findViewById(R.id.button);</span><br><span class="line">        textView = findViewById(R.id.textView);</span><br><span class="line">        imageView = findViewById(R.id.imageView);</span><br><span class="line">        button.setOnClickListener(v -&gt; &#123;</span><br><span class="line">            <span class="comment">// 像网络请求这种线程阻塞的操作，禁止在主线程中执行</span></span><br><span class="line">            <span class="comment">// enqueue()为异步方法，将请求任务加入应用全局异步请求队列</span></span><br><span class="line">            <span class="comment">// 在异步子线程中获取响应对象，在主线程，回调结果。即onResponse()方法为主线程调用</span></span><br><span class="line">            service.listNews().enqueue(<span class="keyword">new</span> Callback&lt;NewsDTO&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;NewsDTO&gt; call, Response&lt;NewsDTO&gt; response)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (response.body() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 基于converter-gson自动完成反序列化</span></span><br><span class="line">                    NewsDTO newsDTO = response.body();</span><br><span class="line">                    List&lt;News&gt; newsList = newsDTO.newsList;</span><br><span class="line">                    textView.setText(newsList.get(<span class="number">0</span>).title);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;NewsDTO&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 基于图片资源地址，获取渲染图片</span></span><br><span class="line">            service.getBitmap(<span class="string">&quot;resources/pics/Spain_Flag.jpg&quot;</span>).enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">                    Log.i(TAG, <span class="string">&quot;image&quot;</span>);</span><br><span class="line">                    <span class="comment">// BitmapFactory类，提供将多种类型数据转为bitmap的静态方法</span></span><br><span class="line">                    Bitmap bitmap = BitmapFactory.decodeStream( response.body().byteStream());</span><br><span class="line">                    imageView.setImageBitmap(bitmap);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.act_main_button_tosec).setOnClickListener(v -&gt; &#123;</span><br><span class="line">            Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, SecActivity.class);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h6 id="Databinding-amp-ViewModel-amp-BindingAdapter"><a href="#Databinding-amp-ViewModel-amp-BindingAdapter" class="headerlink" title="Databinding &amp; ViewModel &amp; BindingAdapter"></a>Databinding &amp; ViewModel &amp; BindingAdapter</h6><p>添加ViewModel LiveData依赖，声明启动Databinding  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dataBinding &#123;</span><br><span class="line">    enabled = <span class="keyword">true</span></span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    def lifecycle_version = <span class="string">&quot;2.0.0&quot;</span></span><br><span class="line">    <span class="comment">// ViewModel and LiveData</span></span><br><span class="line">    implementation <span class="string">&quot;androidx.lifecycle:lifecycle-extensions:$lifecycle_version&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建Recyclerview item布局，绑定实体对象，自定义图片网络地址属性  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;news&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;com.example.example13.entity.News&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">...</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自定义imageUrl属性标签，自定义处理的的adapter --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:imageUrl</span>=<span class="string">&quot;@&#123;news.picAddress&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建自定义图片绑定适配器，基于动态绑定的图片网络地址，下载图片并渲染  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImageBindingAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MyImageBindingAdapter&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 直接声明imageUrl属性，而非app:imageUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> view 第一个参数，是自动传入的，绑定的imageview控件对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url 第二个参数，为动态绑定的属性值，即图片网络地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@BindingAdapter(&#123;&quot;imageUrl&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadImage</span><span class="params">(ImageView view, String url)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 默认渲染图片</span></span><br><span class="line">        <span class="keyword">if</span> (url == <span class="keyword">null</span>) &#123;</span><br><span class="line">            view.setImageResource(R.mipmap.ic_launcher);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ServiceFactory.getNewsService().getBitmap(url).enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (response.body() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                view.setImageBitmap(BitmapFactory.decodeStream(response.body().byteStream()));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">                Log.e(TAG, <span class="string">&quot;onFailure: &quot;</span>, t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建ViewModel，声明绑定生命周期的可观测数据，新闻集合<br>创建加载方法，通过网络加载数据，并更新可观测数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> MutableLiveData&lt;List&lt;News&gt;&gt; newsList = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> NewsService newsService = ServiceFactory.getNewsService();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecViewModel</span><span class="params">(<span class="meta">@NonNull</span> Application application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(application);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadNews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        newsService.listNews().enqueue(<span class="keyword">new</span> Callback&lt;NewsDTO&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;NewsDTO&gt; call, Response&lt;NewsDTO&gt; response)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (response.body() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                List&lt;News&gt; news = response.body().newsList;</span><br><span class="line">                newsList.setValue(news);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;NewsDTO&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改layout布局，绑定VM，添加recycleview  </p>
<p>创建recycleview的adapter，新闻集合属性，绑定item  </p>
<p>修改<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example13/src/main/java/com/example/example13/SecActivity.java">activity代码</a>，构造recycleview，绑定VM，绑定生命周期，监听网络返回的数据，通知adapter更新  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// 监听MV中数据更新，注入结果</span></span><br><span class="line">        viewModel.newsList.observe(<span class="keyword">this</span>, news -&gt; &#123;</span><br><span class="line">            <span class="comment">// 将最新数据交由adapter渲染</span></span><br><span class="line">            adapter.setCurrentNewsList(news);</span><br><span class="line">            adapter.notifyDataSetChanged();</span><br><span class="line">            <span class="comment">// 更新到顶部</span></span><br><span class="line">            recyclerView.scrollToPosition(<span class="number">0</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        viewModel.loadNews();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h6 id="Post-Request"><a href="#Post-Request" class="headerlink" title="Post Request"></a>Post Request</h6><p>在接口添加post请求  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 即使没有返回值，也必须封装一个空类型Void</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@POST(&quot;news&quot;)</span></span><br><span class="line">   <span class="function">Call&lt;ResponseBody&gt; <span class="title">post</span><span class="params">(<span class="meta">@Body</span> News n)</span></span>; <span class="comment">//Call&lt;Void&gt; post(@Body News n);</span></span><br></pre></td></tr></table></figure>

<p>创建第三个activity，实现2个输入框，1个button<br>实现当点击button时，调用post请求向服务器发送数据<br> 重写SecActivity onStart()方法，调用VM中的网络数据加载方法，确保从暂停状态恢复，重新加载  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThirdActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;ThirdActivity&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> EditText title;</span><br><span class="line">    <span class="keyword">private</span> EditText subtitle;</span><br><span class="line">    <span class="keyword">private</span> Button submit;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_thrid);</span><br><span class="line">        title = findViewById(R.id.act_third_edittext_title);</span><br><span class="line">        subtitle = findViewById(R.id.act_third_edittext_subtitle);</span><br><span class="line">        findViewById(R.id.act_third_button).setOnClickListener(v -&gt; &#123;</span><br><span class="line">            News n = <span class="keyword">new</span> News();</span><br><span class="line">            n.title = <span class="string">&quot;&quot;</span> + title.getText().toString();</span><br><span class="line">            n.subtitle = <span class="string">&quot;&quot;</span> + subtitle.getText().toString();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 不能仅执行post()方法，必须执行enqueue()方法添加至执行队列</span></span><br><span class="line">            ServiceFactory.getNewsService().post(n).enqueue(<span class="keyword">new</span> Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//  结束此activity</span></span><br><span class="line">                    finish();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;ResponseBody&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h5 id="Example-14-Room"><a href="#Example-14-Room" class="headerlink" title="Example 14 Room"></a>Example 14 Room</h5><h6 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h6><p>SQLite数据库，SQLite操作无需系统权限  </p>
<p>启动/引入数据绑定，VM，等     引用Room依赖  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    dataBinding &#123;</span><br><span class="line">        enabled = true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    def lifecycle_version = &quot;2.0.0&quot;</span><br><span class="line">    def room_version = &quot;2.0.0&quot;</span><br><span class="line">    implementation &quot;android.arch.lifecycle:extensions:$lifecycle_version&quot;</span><br><span class="line">    implementation &quot;android.arch.persistence.room:runtime:$room_version&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义引入application备用 （在AndroidManifest中引入） </p>
<p>创建实体类  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey(autoGenerate = true)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> String detail;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建操作实体类的DAO层接口  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Query(&quot;SELECT * FROM Course&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Course&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(&quot;SELECT * FROM Course c WHERE c.id=:id&quot;)</span></span><br><span class="line">    <span class="function">Course <span class="title">find</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支持指定的封装属性，而非全部属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Query(&quot;SELECT c.id, c.name FROM Course c&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Course&gt; <span class="title">listName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span></span><br><span class="line">    <span class="meta">@Transaction</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Course... course)</span></span>; <span class="comment">//支持同时传入多个course</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建<a target="_blank" rel="noopener" href="https://github.com/zhanyeye/android-examples/blob/master/example14/src/main/java/com/example/example14/repository/DatabaseFactory.java">数据库工厂</a>，封装构造过程，暴露DAO接口(代理类)  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自动在data/data/应用包/下，创建databases目录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Database(entities = &#123;Course.class&#125;, version = 1, exportSchema = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseFactory</span> <span class="keyword">extends</span> <span class="title">RoomDatabase</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明的是抽查类，以及抽象方法，而不是接口！～</span></span><br><span class="line"><span class="comment">     * android自动实现抽象方法，并动态生成接口代理类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> CourseDao <span class="title">courseDao</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基于全局context，数据库配置类(就是此类)，数据库名称，构建数据库工厂</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DatabaseFactory dataBaseFactory = Room</span><br><span class="line">            .databaseBuilder(MyApplication.getInstance(), DatabaseFactory.class, &quot;database&quot;)</span><br><span class="line">            <span class="comment">// 默认SQLite数据库查询操作在子线程异步执行，添加/修改/删除在主线程，可强制全部使用主线程</span></span><br><span class="line">            .allowMainThreadQueries()     <span class="comment">//允许主线程，可以取消，在子线程中postvalue(),传给子线程</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 仅对外暴露自动创建的接口代理对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CourseDao <span class="title">getCourseDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataBaseFactory.courseDao();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建VM，从数据库获取数据，加载到observer对象 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;MainViewModel&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> MutableLiveData&lt;List&lt;Course&gt;&gt; coursesM = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span><span class="params">(<span class="meta">@NonNull</span> Application application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(application);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadFromRoom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Course&gt; courses = DatabaseFactory.getCourseDao().listName();</span><br><span class="line">        coursesM.setValue(courses);</span><br><span class="line">        <span class="comment">//coursesM.postValue(courses);    //如果是子线程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建item layout，recyclerview adapter，完成基本绑定操作  </p>
<p>修改activity代码，完成初始化，数据监听等操作  </p>
<h6 id="Insert-amp-Snackbar"><a href="#Insert-amp-Snackbar" class="headerlink" title="Insert   &amp; Snackbar"></a>Insert   &amp; Snackbar</h6><p>创建VM，声明绑定数据，声明添加方法，调用接口实现数据的插入  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsertCourseViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> MutableLiveData&lt;Course&gt; courseM = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InsertCourseViewModel</span><span class="params">(<span class="meta">@NonNull</span> Application application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(application);</span><br><span class="line">        courseM.setValue(<span class="keyword">new</span> Course());    <span class="comment">//因为是双向绑定，所以即便开始没有数据也要要传一个，不然会空指针</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DatabaseFactory.getCourseDao().insert(courseM.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视图双向绑定VM数据，执行VM插入方法  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;insertVM&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;com.example.example14.viewmodel.InsertCourseViewModel&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">...</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">&quot;课程名称&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@=&#123;insertVM.courseM.name&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">&quot;课程介绍&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@=&#123;insertVM.courseM.detail&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">...</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;提交&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;insert&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建展示详细信息activity，修改adapter，绑定item点击监听，传递被点击item对应的数据ID参数跳转  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsertCourseActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> InsertCourseViewModel vm;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        vm = ViewModelProviders.of(<span class="keyword">this</span>).get(InsertCourseViewModel.class);</span><br><span class="line">        ActivityInsertCourseBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_insert_course);</span><br><span class="line">        binding.setInsertVM(vm);</span><br><span class="line">        binding.setLifecycleOwner(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用VM方法实现添加</span></span><br><span class="line">        vm.insert();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Snackbar,需引入material依赖；</span></span><br><span class="line"><span class="comment">         * Toast，浮动显示，即使activity等已退出依然显示</span></span><br><span class="line"><span class="comment">         * snackbar，需要一个view对象，在当前视图显示；</span></span><br><span class="line"><span class="comment">         * 支持像Toast显示short/long时间自动收回</span></span><br><span class="line"><span class="comment">         * 支持定义互交操作</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Snackbar.make(view, <span class="string">&quot;课程添加成功&quot;</span>, Snackbar.LENGTH_INDEFINITE)</span><br><span class="line">                .setAction(<span class="string">&quot;确定&quot;</span>, v -&gt; &#123;</span><br><span class="line">                    finish();    <span class="comment">//结束当前activity</span></span><br><span class="line">                &#125;).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainRecyclerViewAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">MainRecyclerViewAdapter</span>.<span class="title">MyViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainRecyclerViewAdapter</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(<span class="meta">@NonNull</span> MyViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        holder.binding.setCourse(courseList.get(position));</span><br><span class="line">        holder.itemView.setOnClickListener(v -&gt; &#123;   <span class="comment">//绑定一个点击事件</span></span><br><span class="line">            Intent i = <span class="keyword">new</span> Intent(context, CourseDetailActivity.class);</span><br><span class="line">            i.putExtra(<span class="string">&quot;id&quot;</span>, courseList.get(position).id);</span><br><span class="line">            context.startActivity(i);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>展示详细信息  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;layout&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">&quot;vm&quot;</span></span><br><span class="line">            type=<span class="string">&quot;com.example.example14.viewmodel.CourseDetailViewModel&quot;</span> /&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">&lt;LinearLayout ...&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        ...</span><br><span class="line">        android:text=<span class="string">&quot;@&#123;vm.courseM.name&#125;&quot;</span>/&gt;</span><br><span class="line">    &lt;TextView</span><br><span class="line">        ...</span><br><span class="line">        android:text=<span class="string">&quot;@&#123;vm.courseM.detail&#125;&quot;</span>/&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br><span class="line">&lt;/layout&gt;</span><br><span class="line"><span class="comment">//--------</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseDetailViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> MutableLiveData&lt;Course&gt; courseM = <span class="keyword">new</span> MutableLiveData&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CourseDetailViewModel</span><span class="params">(<span class="meta">@NonNull</span> Application application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(application);</span><br><span class="line">        courseM.setValue(<span class="keyword">new</span> Course());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getCourse</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Course c = DatabaseFactory.getCourseDao().find(id);</span><br><span class="line">        courseM.setValue(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//--------</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseDetailActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果是单activity切换fragment，就不用这么麻烦了</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> savedInstanceState</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        ActivityCourseDetailBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_course_detail);</span><br><span class="line">        CourseDetailViewModel vm = ViewModelProviders.of(<span class="keyword">this</span>).get(CourseDetailViewModel.class);</span><br><span class="line">        binding.setVm(vm);</span><br><span class="line">        binding.setLifecycleOwner(<span class="keyword">this</span>);</span><br><span class="line">        vm.getCourse(getIntent().getIntExtra(<span class="string">&quot;id&quot;</span>, <span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Snackbar的引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#x27;com.google.android.material:material:1.0.0&#x27;</span><br></pre></td></tr></table></figure>



<h5 id="Example-15-External-Storage"><a href="#Example-15-External-Storage" class="headerlink" title="Example 15 External Storage"></a>Example 15 External Storage</h5><h6 id="Internal-Storage"><a href="#Internal-Storage" class="headerlink" title="Internal Storage"></a>Internal Storage</h6><p>内存储，其他应用无法访问的应用程序的独立空间，使用无需声明权限<br>文件随应用删除而删除，空间有限，放应用必须文件<br>getFilesDir()   拿files 中的文件夹<br>getCacheDir()  拿缓存中的文件夹     </p>
<p>都是上下文的方法</p>
<p>/data/data/packagename/files</p>
<h6 id="External-Storage"><a href="#External-Storage" class="headerlink" title="External Storage"></a>External Storage</h6><p>外存储私有空间，无需声明权限，随应用卸载删除，放普通文件，缓存文件<br>挂载到，/mnt/sdcard/android/data/packname/files<br>getExternalFilesDir()/getExternalCacheDir()</p>
<p>外存储公共空间，Android公共目录，音乐，图片等等，需声明权限<br>挂载到，/mnt/sdcard/<br>Environment.getExternalStoragePublicDirectory()</p>
<p>manifest 中： <code>&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</code></p>
<hr>
<h5 id="Example-16-Dialogs"><a href="#Example-16-Dialogs" class="headerlink" title="Example 16 Dialogs"></a>Example 16 Dialogs</h5><p>构造<a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/topics/ui/dialogs#AlertDialog">AlertDialog</a><br>自定义确认、取消、中性等按钮回调<br>单选项<br>单选项带确认按钮<br>自定义布局样式<br>多选项带确认按钮<br>DatePickerDialog，minsdk 24  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> Button button2;</span><br><span class="line">    <span class="keyword">private</span> Button button3;</span><br><span class="line">    <span class="keyword">private</span> Button button4;</span><br><span class="line">    <span class="keyword">private</span> Button button5;</span><br><span class="line">    <span class="keyword">private</span> Button button6;</span><br><span class="line">    <span class="keyword">private</span> Button button7;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button = findViewById(R.id.button1);</span><br><span class="line">        button2 = findViewById(R.id.button2);</span><br><span class="line">        button3 = findViewById(R.id.button3);</span><br><span class="line">        button4 = findViewById(R.id.button4);</span><br><span class="line">        button5 = findViewById(R.id.button5);</span><br><span class="line">        button6 = findViewById(R.id.button6);</span><br><span class="line">        button7 = findViewById(R.id.button7);</span><br><span class="line">        button.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        button2.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        button3.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        button4.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        button5.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        button6.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        button7.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String[] arrayFruit = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;苹果&quot;</span>, <span class="string">&quot;橘子&quot;</span>, <span class="string">&quot;草莓&quot;</span>, <span class="string">&quot;香蕉&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">boolean</span>[] checkedItems = <span class="keyword">new</span> <span class="keyword">boolean</span>[arrayFruit.length];</span><br><span class="line">    <span class="keyword">int</span> selectIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.button1:</span><br><span class="line">                <span class="comment">// 用于警告等，合理基于设备返回键</span></span><br><span class="line">                <span class="comment">// 基于builder模式构建</span></span><br><span class="line">                AlertDialog.Builder dialog = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</span><br><span class="line">                dialog.setTitle(<span class="string">&quot;标题&quot;</span>);</span><br><span class="line">                dialog.setMessage(<span class="string">&quot;内容&quot;</span>);</span><br><span class="line">                dialog.setIcon(R.mipmap.ic_launcher);</span><br><span class="line">                dialog.show();   <span class="comment">//show 已经实现了 build()</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.button2:</span><br><span class="line">                AlertDialog.Builder dialog2 = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</span><br><span class="line">                dialog2.setTitle(<span class="string">&quot;删除&quot;</span>);</span><br><span class="line">                dialog2.setMessage(<span class="string">&quot;确定删除吗?&quot;</span>);</span><br><span class="line">                <span class="comment">// 确认按钮回调</span></span><br><span class="line">                dialog2.setPositiveButton(<span class="string">&quot;确定&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 取消回调</span></span><br><span class="line">                dialog2.setNegativeButton(<span class="string">&quot;取消&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                        dialog.dismiss();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">// 中间回调</span></span><br><span class="line">                dialog2.setNeutralButton(<span class="string">&quot;详细内容&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                dialog2.show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.button3:</span><br><span class="line">                <span class="comment">// 单选按钮组</span></span><br><span class="line">                AlertDialog.Builder dialog3 = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</span><br><span class="line">                dialog3.setTitle(<span class="string">&quot;水果&quot;</span>);</span><br><span class="line">                dialog3.setItems(arrayFruit, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                    <span class="comment">// 传入的which为被选中的位置</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, arrayFruit[which], Toast.LENGTH_SHORT)</span><br><span class="line">                                .show();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                dialog3.show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.button4:</span><br><span class="line">                <span class="comment">// 单选，添加确认按钮</span></span><br><span class="line">                AlertDialog.Builder dialog4 = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</span><br><span class="line">                dialog4.setTitle(<span class="string">&quot;水果&quot;</span>);</span><br><span class="line">                <span class="comment">//传入selectIndex，否则要是final,</span></span><br><span class="line">                dialog4.setSingleChoiceItems(arrayFruit, selectIndex, <span class="keyword">new</span> DialogInterface</span><br><span class="line">                        .OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                        selectIndex = which;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                dialog4.setPositiveButton(<span class="string">&quot;确定&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                    <span class="comment">// which不是被选中项目，按钮与选项无关</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, arrayFruit[selectIndex], Toast</span><br><span class="line">                                .LENGTH_SHORT).show();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                dialog4.show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.button5:</span><br><span class="line">                <span class="comment">// 自定义样式填充</span></span><br><span class="line">                AlertDialog.Builder dialog5 = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</span><br><span class="line">                LayoutInflater inflater = LayoutInflater.from(<span class="keyword">this</span>);</span><br><span class="line">            View rootView = inflater.inflate(R.layout.dialog_login, <span class="keyword">null</span>); <span class="comment">//因为弹出一个窗口，所以没有root,null</span></span><br><span class="line">                dialog5.setTitle(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">                dialog5.setView(rootView);</span><br><span class="line">                dialog5.show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.button6:</span><br><span class="line">                <span class="comment">// 多选，带确认按钮</span></span><br><span class="line">                AlertDialog.Builder dialog6 = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</span><br><span class="line">                dialog6.setTitle(<span class="string">&quot;多选&quot;</span>);</span><br><span class="line">                dialog6.setIcon(R.mipmap.ic_launcher);</span><br><span class="line">                dialog6.setMultiChoiceItems(arrayFruit, checkedItems, <span class="keyword">new</span> DialogInterface</span><br><span class="line">                        .OnMultiChoiceClickListener() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which, <span class="keyword">boolean</span> isChecked)</span> </span>&#123;</span><br><span class="line">                        String string;</span><br><span class="line">                        <span class="keyword">if</span> (isChecked) &#123;</span><br><span class="line">                            string = <span class="string">&quot;被选中了&quot;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            string = <span class="string">&quot;被取消了&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, arrayFruit[which] + string, Toast</span><br><span class="line">                                .LENGTH_SHORT).show();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                dialog6.setPositiveButton(<span class="string">&quot;确定&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</span><br><span class="line">                        StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arrayFruit.length; i++) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (checkedItems[i]) &#123;</span><br><span class="line">                                buffer.append(arrayFruit[i]);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;被选中的水果: &quot;</span> + buffer.toString(), Toast</span><br><span class="line">                                .LENGTH_SHORT).show();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                dialog6.show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.button7:</span><br><span class="line">                <span class="comment">// DatePickerDialog minsdk最低版本24，此处只有在系统版本大于24时执行有效</span></span><br><span class="line">                <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.N) &#123;</span><br><span class="line">                    DatePickerDialog dialog7 = <span class="keyword">new</span> DatePickerDialog(<span class="keyword">this</span>);</span><br><span class="line">                    <span class="keyword">final</span> Calendar calendar = Calendar.getInstance();</span><br><span class="line">                    dialog7.setOnDateSetListener(<span class="keyword">new</span> DatePickerDialog.OnDateSetListener() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDateSet</span><span class="params">(DatePicker view, <span class="keyword">int</span> year, <span class="keyword">int</span> month, <span class="keyword">int</span> dayOfMonth)</span> </span>&#123;</span><br><span class="line">                            calendar.set(Calendar.YEAR, year);</span><br><span class="line">                            calendar.set(Calendar.MONTH, month);</span><br><span class="line">                            calendar.set(Calendar.DAY_OF_MONTH, dayOfMonth);</span><br><span class="line">                            String result = <span class="string">&quot;日期: &quot;</span></span><br><span class="line">                                    + calendar.get(Calendar.YEAR) + <span class="string">&quot;-&quot;</span></span><br><span class="line">                                    + calendar.get(Calendar.MONTH) + <span class="string">&quot;-&quot;</span></span><br><span class="line">                                    + calendar.get(Calendar.DAY_OF_MONTH);</span><br><span class="line">                            Toast.makeText(MainActivity.<span class="keyword">this</span>, result , Toast.LENGTH_SHORT).show();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    dialog7.show();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="Example-17-Capture-amp-Gallery"><a href="#Example-17-Capture-amp-Gallery" class="headerlink" title="Example 17 Capture &amp; Gallery"></a>Example 17 Capture &amp; Gallery</h5><p>声明外存储写入权限<br><code>&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</code></p>
<p>在配置中通过screenOrientation属性，将Activity强制设为横向或纵向屏幕，防止手机晃动后activity重置  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span> <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span>&gt;</span>   ...</span><br></pre></td></tr></table></figure>

<p>在xml资源目录下，创建共享目录配置  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">res/xml/files_path</span><br><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 相当于Environment.getExternalStorageDirectory()获取的公共空间根路径，被替换 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-path</span> <span class="attr">name</span>=<span class="string">&quot;public_path&quot;</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 还可声明其他私有、缓存、外存储得到空间 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在项目配置注册provider，并引用共享配置  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">AndroidManifest</span><br><span class="line"><span class="comment">&lt;!-- authorities一般与applicationId相同，即应用包名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;androidx.core.content.FileProvider&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:authorities</span>=<span class="string">&quot;com.example.example17&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:grantUriPermissions</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:name</span>=<span class="string">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:resource</span>=<span class="string">&quot;@xml/file_paths&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>在activity自定义照相请求码，写入权限码<br>在公共空间/DCIM/Camera/下，创建一个指定名称的图片文件，用于保存照片<br>创建拍照方法，基于FileProvider获取图片URI地址<br>启动需要结果的照相intent，封装请求吗及强制文件存储的URI地址<br>重写onActivityResult()方法，基于请求码判断返回的执行请求<br>未防止OOM，将图片按1/4渲染  </p>
<p>Android6以后，要求运行时动态申请权限(类似iOS)<br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/permissions/requesting">https://developer.android.google.cn/training/permissions/requesting</a><br>重写onRequestPermissionsResult()方法，在用户授权后执行拍照方法<br>刷新相册(可选)  </p>
<p>模拟器，可通过按住alt+鼠标移动镜头，wasd控制方向  Capture</p>
<h5 id="Example-18-Notification"><a href="#Example-18-Notification" class="headerlink" title="Example 18 Notification"></a>Example 18 Notification</h5><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/notify-user/build-notification">https://developer.android.google.cn/training/notify-user/build-notification</a> 构造Notification，声明必须属性<br>创建PendingIntent对象，封装点击通知intent<br>基于版本构造NotificationChannel<br>发送通知</p>
<h5 id="Example-19-Service"><a href="#Example-19-Service" class="headerlink" title="Example 19 Service"></a>Example 19 Service</h5><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/components/services.html">https://developer.android.google.cn/guide/components/services.html</a><br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/guide/components/bound-services.html">https://developer.android.google.cn/guide/components/bound-services.html</a><br><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/run-background-service/create-service.html">https://developer.android.google.cn/training/run-background-service/create-service.html</a></p>
<p>自定义服务，封装操作值<br>重写onCreate()方法，创建子线程执行操作<br>自定义Binder子类，重写onBind()方法<br>重写onStartCommand()方法，接收初始化参数<br>修改项目配置，注册自定义服务</p>
<p>在activity中，自定义类实现ServiceConnection接口<br>基于自定义ServiceConnection服务连接类获取绑定对象<br>与服务互交，完成操作</p>
<h5 id="Example-20-BroadcastReceiver"><a href="#Example-20-BroadcastReceiver" class="headerlink" title="Example 20 BroadcastReceiver"></a>Example 20 BroadcastReceiver</h5><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/content/BroadcastReceiver.html">https://developer.android.google.cn/reference/android/content/BroadcastReceiver.html</a></p>
<p>自定义接收器，重写onReceive()方法，监听指定action操作<br>自定义服务，在服务中注册/注销接收器，并声明监听的action<br>在项目配置中，注册服务，接收器<br>在activity中启动服务，监听action变化</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/05/09/19-05-09%20ERP-%E5%A4%8D%E4%B9%A0/" rel="prev" title="ERP 复习">
      <i class="fa fa-chevron-left"></i> ERP 复习
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/05/18/19-05-18-%E8%8B%B1%E8%AF%AD%E4%BD%9C%E6%96%87%E9%AB%98%E7%BA%A7%E5%8F%A5/" rel="next" title="英语作文高级句">
      英语作文高级句 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhanyeye</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  















  

  

</body>
</html>

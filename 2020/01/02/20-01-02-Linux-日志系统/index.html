<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"8.0.0-rc.5","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false};
  </script>

  <meta name="description" content="内容来自实验楼 日志文件常见的日志文件12$ sudo service rsyslog start$ ll &#x2F;var&#x2F;log      日志名称 信息说明    alternatives.log 系统的更新替代信息   apport.log 应用程序崩溃信息记录   apt&#x2F;history.log 使用 apt-get 安装卸载软件的信息记录   apt&#x2F;term.log 使用 apt-get 时">
<meta property="og:type" content="article">
<meta property="og:title" content="20-01-02 Linux 日志系统">
<meta property="og:url" content="http://yoursite.com/2020/01/02/20-01-02-Linux-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="zhanyeye&#39;s learning log">
<meta property="og:description" content="内容来自实验楼 日志文件常见的日志文件12$ sudo service rsyslog start$ ll &#x2F;var&#x2F;log      日志名称 信息说明    alternatives.log 系统的更新替代信息   apport.log 应用程序崩溃信息记录   apt&#x2F;history.log 使用 apt-get 安装卸载软件的信息记录   apt&#x2F;term.log 使用 apt-get 时">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/zhanyeye/Figure-bed/win-pic/img/20200102151850.png">
<meta property="og:image" content="https://doc.shiyanlou.com/document-uid276733labid3921timestamp1509882827692.png/wm">
<meta property="article:published_time" content="2020-01-02T06:21:21.000Z">
<meta property="article:modified_time" content="2020-08-01T07:08:09.517Z">
<meta property="article:author" content="zhanyeye">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/zhanyeye/Figure-bed/win-pic/img/20200102151850.png">

<link rel="canonical" href="http://yoursite.com/2020/01/02/20-01-02-Linux-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>20-01-02 Linux 日志系统 | zhanyeye's learning log</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">zhanyeye's learning log</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">(^～^)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">日志文件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">常见的日志文件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.2.</span> <span class="nav-text">日志格式</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#rsyslog-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97"><span class="nav-number">2.</span> <span class="nav-text">rsyslog 系统日志</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#rsyslog-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E6%A6%82%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">rsyslog 系统日志概述</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#rsyslog-%E7%9A%84%E7%BB%93%E6%9E%84%E6%A1%86%E6%9E%B6"><span class="nav-number">2.2.</span> <span class="nav-text">rsyslog 的结构框架</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="nav-number">2.3.</span> <span class="nav-text">配置文件内容</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#rsyslog-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">rsyslog 系统日志的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E8%AE%BE%E5%A4%87-%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.1.</span> <span class="nav-text">日志设备(类型)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="nav-number">3.2.</span> <span class="nav-text">日志级别</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E7%AC%A6%E5%8F%B7"><span class="nav-number">3.3.</span> <span class="nav-text">连接符号</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%9A%84%E8%BD%AC%E5%82%A8"><span class="nav-number">4.</span> <span class="nav-text">日志文件的转储</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#logrotate-%E7%AE%A1%E7%90%86%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">4.1.</span> <span class="nav-text">logrotate 管理日志文件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#logrotate-%E6%97%A5%E5%BF%97%E8%BD%AC%E5%82%A8"><span class="nav-number">4.2.</span> <span class="nav-text">logrotate 日志转储</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zhanyeye</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhanyeye" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhanyeye" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/02/20-01-02-Linux-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhanyeye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zhanyeye's learning log">
    </span>

    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          20-01-02 Linux 日志系统
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-02 14:21:21" itemprop="dateCreated datePublished" datetime="2020-01-02T14:21:21+08:00">2020-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-01 15:08:09" itemprop="dateModified" datetime="2020-08-01T15:08:09+08:00">2020-08-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>内容来自<a target="_blank" rel="noopener" href="https://www.shiyanlou.com/">实验楼</a></p>
<h5 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h5><h6 id="常见的日志文件"><a href="#常见的日志文件" class="headerlink" title="常见的日志文件"></a>常见的日志文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service rsyslog start</span><br><span class="line">$ ll /var/<span class="built_in">log</span> </span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>日志名称</th>
<th>信息说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>alternatives.log</code></td>
<td>系统的更新替代信息</td>
</tr>
<tr>
<td><code>apport.log</code></td>
<td>应用程序崩溃信息记录</td>
</tr>
<tr>
<td><code>apt/history.log</code></td>
<td>使用 apt-get 安装卸载软件的信息记录</td>
</tr>
<tr>
<td><code>apt/term.log</code></td>
<td>使用 apt-get 时的具体操作</td>
</tr>
<tr>
<td><code>auth.log</code></td>
<td>登录认证的 log 信息</td>
</tr>
<tr>
<td><code>boot.log</code></td>
<td>系统启动时的日志信息</td>
</tr>
<tr>
<td><code>btmp</code></td>
<td>记录所有失败启动信息</td>
</tr>
<tr>
<td><code>dmesg</code></td>
<td>内核缓冲信息，在系统启动时，显示屏幕上的与硬件有关的信息</td>
</tr>
<tr>
<td><code>dpkg.log</code></td>
<td>安装或 dpkg 命令清除软件包的日志</td>
</tr>
<tr>
<td><code>kern.log</code></td>
<td>内核产生的日志，有助于在定制内核时解决问题</td>
</tr>
<tr>
<td><code>lastlog</code></td>
<td>记录所有用户的最近信息。这不是一个 ASCII 文件，因此需要用 lastlog 命令查看内容</td>
</tr>
<tr>
<td><code>faillog</code></td>
<td>用户登录失败信息。此外，错误登录命令也会记录在本文件中</td>
</tr>
<tr>
<td><code>wtmp</code></td>
<td>包含登录信息。使用 wtmp 可以找出谁正在登陆进入系统，谁使用命令显示这个文件或信息等</td>
</tr>
<tr>
<td><code>syslog</code></td>
<td>系统信息记录</td>
</tr>
</tbody></table>
<a id="more"></a>

<h6 id="日志格式"><a href="#日志格式" class="headerlink" title="日志格式"></a>日志格式</h6><p>日志内容的一般格式</p>
<ul>
<li>事件发生的时间</li>
<li>发生的主机名</li>
<li>启动的服务名称</li>
<li>实际信息内容</li>
</ul>
<p><code>cat</code> 命令来查看一下几个常见日志文件的格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统的更新替代信息</span></span><br><span class="line">$ cat /var/<span class="built_in">log</span>/alternatives.log.1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">update-alternatives 2019-12-17 14:08:49: link group serialver updated to point to /usr/lib/jvm/java-11-openjdk-amd64/bin/serialver</span><br><span class="line">update-alternatives 2019-12-17 14:08:49: run with --install /usr/bin/jaotc jaotc /usr/lib/jvm/java-11-openjdk-amd64/bin/jaotc 1111</span><br><span class="line">update-alternatives 2019-12-17 14:08:49: link group jaotc updated to point to /usr/lib/jvm/java-11-openjdk-amd64/bin/jaotc</span><br><span class="line">update-alternatives 2019-12-17 14:08:49: run with --install /usr/bin/jhsdb jhsdb /usr/lib/jvm/java-11-openjdk-amd64/bin/jhsdb 1111</span><br><span class="line">update-alternatives 2019-12-17 14:08:49: link group jhsdb updated to point to /usr/lib/jvm/java-11-openjdk-amd64/bin/jhsdb</span><br><span class="line"><span class="comment"># alternatives.log 中得到信息有程序作用，日期，命令，成功与否的返回码等信息。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 dpkg.log 文件中可以知道 dpkg 命令安装或清除软件包的时间、安装包版本等日志信息。</span></span><br><span class="line">$ cat /var/<span class="built_in">log</span>/dpkg.log.1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2019-12-17 14:08:50 status half-configured systemd:amd64 237-3ubuntu10.33</span><br><span class="line">2019-12-17 14:08:50 status installed systemd:amd64 237-3ubuntu10.33</span><br><span class="line">2019-12-17 14:08:50 trigproc man-db:amd64 2.8.3-2ubuntu0.1 &lt;none&gt;</span><br><span class="line">2019-12-17 14:08:50 status half-configured man-db:amd64 2.8.3-2ubuntu0.1</span><br><span class="line">2019-12-17 14:08:52 status installed man-db:amd64 2.8.3-2ubuntu0.1</span><br><span class="line">2019-12-17 14:08:52 trigproc ca-certificates:all 20180409 &lt;none&gt;</span><br><span class="line">2019-12-17 14:08:52 status half-configured ca-certificates:all 20180409</span><br><span class="line">2019-12-17 14:08:52 status installed ca-certificates-java:all 20180516ubuntu1~18.04.1</span><br><span class="line">2019-12-17 14:08:52 status installed ca-certificates:all 20180409</span><br></pre></td></tr></table></figure>

<p>在 <code>apt</code> 文件夹中的日志信息，其中有两个日志文件 <code>history.log</code> 与 <code>term.log</code> ，两个日志文件的区别在于 <code>history.log</code> 主要记录了进行了什么操作，相关的依赖有哪些，而 <code>term.log</code> 则是较为具体的一些操作，主要就是下载包，打开包，安装包等等的细节操作。</p>
<p>先来看 <code>var/log/apt/history.log</code> 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Start-Date: 2020-01-02  14:56:07</span><br><span class="line">Commandline: apt install tree</span><br><span class="line">Requested-By: ubuntu (500)</span><br><span class="line">Install: tree:amd64 (1.7.0-5)</span><br><span class="line">End-Date: 2020-01-02  14:56:09</span><br></pre></td></tr></table></figure>

<p>然后来看 <code>var/log/apt/term.log</code> 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Log started: 2020-01-02  14:56:07</span><br><span class="line">Selecting previously unselected package tree.</span><br><span class="line">(Reading database ... 116069 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../tree_1.7.0-5_amd64.deb ...</span><br><span class="line">Unpacking tree (1.7.0-5) ...</span><br><span class="line">Setting up tree (1.7.0-5) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> man-db (2.8.3-2ubuntu0.1) ...</span><br><span class="line">Log ended: 2020-01-02  14:56:09</span><br></pre></td></tr></table></figure>

<p>像上面几个日志的格式内容大部分都是时间，操作这样。不过还有有两个比较特殊的日志，它们的查看的方式也比较与众不同，因为这两个日志并不是 <code>ASCII 文件</code> 而是被编码成了<code>二进制文件</code>，所以不能直接使用 <code>less、cat、more</code> 这样的工具命令来查看，这两个日志文件是 <strong>wtmp，lastlog</strong>。</p>
<p>查看的方法是使用 <code>last</code> 和 <code>lastlog</code> 工具来提取其中的信息。</p>
<ul>
<li>last</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ last</span><br></pre></td></tr></table></figure>

<ul>
<li>lastlog</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ lastlog --<span class="built_in">help</span></span><br><span class="line">用法：lastlog [选项]</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">   -b, --before DAYS     仅打印早于 DAYS 的最近登录记录</span><br><span class="line">   -h, --<span class="built_in">help</span>         显示此帮助信息并推出</span><br><span class="line">   -R, --root CHROOT_DIR chroot 到的目录 </span><br><span class="line">   -t, --time DAYS 仅打印晚于 DAYS 的最近登录记录</span><br><span class="line">   -u, --user LOGIN     打印 LOGIN 用户的最近登录记录</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ last</span><br><span class="line">ubuntu   pts/0        1.190.238.60     Thu Jan  2 14:42   still logged <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">$ lastlog -u ubuntu</span><br><span class="line">Username         Port     From             Latest</span><br><span class="line">ubuntu           pts/0    1.190.238.60     Thu Jan  2 14:42:05 +0800 2020</span><br></pre></td></tr></table></figure>

<h5 id="rsyslog-系统日志"><a href="#rsyslog-系统日志" class="headerlink" title="rsyslog 系统日志"></a>rsyslog 系统日志</h5><h6 id="rsyslog-系统日志概述"><a href="#rsyslog-系统日志概述" class="headerlink" title="rsyslog 系统日志概述"></a>rsyslog 系统日志概述</h6><p>日志产生的方式一般存在两种方式：</p>
<ul>
<li>一种是由软件开发商自己来自定义日志格式然后指定输出日志位置；</li>
<li>一种方式就是 Linux 提供的日志服务程序，而我们这里系统日志是通过 syslog 来实现，提供日志管理服务。</li>
</ul>
<p>syslog 是一个系统日志记录程序，在早期的大部分 Linux 发行版都是内置 syslog，让其作为系统的默认日志收集工具，虽然时代的进步与发展，syslog 已经跟不上时代的需求，所以他被 rsyslog 所代替了，较新的 Ubuntu、Fedora 等等都是默认使用 rsyslog 作为系统的日志收集工具。</p>
<p>rsyslog 的全称是 rocket-fast system for log，它提供了高性能，高安全功能和模块化设计。rsyslog 能够接受从各种各样的来源，将其输入，输出的结果到不同的目的地。</p>
<p>其默认的 <code>rsyslog</code> 配置文件是：</p>
<ul>
<li><code>/etc/rsyslog.conf</code> 文件：该配置文件主要决定需要加载的模块、文件所属者等</li>
<li><code>/etc/rsyslog.d/50-default.conf</code>。该文件主要是配置 <code>Filter Conditions</code>，详细内容后续会涉及。）</li>
</ul>
<h6 id="rsyslog-的结构框架"><a href="#rsyslog-的结构框架" class="headerlink" title="rsyslog 的结构框架"></a>rsyslog 的结构框架</h6><p>先通过一个简单的流程图来了解一下 <code>rsyslog</code>的结构框架和数据流走向。</p>
 <img width="400" src="https://raw.githubusercontent.com/zhanyeye/Figure-bed/win-pic/img/20200102151850.png">

<p>通过上面的图片可以看出<code>rsyslog</code> 主要是由</p>
<ul>
<li><code>Input</code></li>
<li><code>Output</code></li>
<li><code>Parser</code></li>
</ul>
<p>三个模块构成的。</p>
<p>其流程是首先通过 <code>Input module</code> 来收集消息，然后将得到的消息传给<code>Parser module</code>，通过分析模块的层层处理，将真正需要的消息传给 <code>Output module</code>，然后便输出至日志文件中。</p>
<p>官方的 Rsyslog 架构如图中所示，rsyslog 还有一个核心的功能模块是 <code>Queue</code>，便是它的存在使得 rsyslog <strong>高并发</strong>优势的突出：</p>
<p><img src="https://doc.shiyanlou.com/document-uid276733labid3921timestamp1509882827692.png/wm" alt="此处输入图片的描述"></p>
<p><a target="_blank" rel="noopener" href="http://www.rsyslog.com/doc/queues_analogy.html">官方 Rsyslog 架构手册</a></p>
<p><strong>Input 模块</strong>：主要功能就是从各种各样的来源收集 messages，通过这些接口实现：</p>
<table>
<thead>
<tr>
<th>接口名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>im3195</td>
<td>RFC3195 Input Module</td>
</tr>
<tr>
<td>imfile</td>
<td>Text File Input Module</td>
</tr>
<tr>
<td>imgssapi</td>
<td>GSSAPI Syslog Input Module</td>
</tr>
<tr>
<td>imjournal</td>
<td>Systemd Journal Input Module</td>
</tr>
<tr>
<td>imklog</td>
<td>Kernel Log Input Module</td>
</tr>
<tr>
<td>imkmsg</td>
<td>/dev/kmsg Log Input Module</td>
</tr>
<tr>
<td>impstats</td>
<td>Generate Periodic Statistics of Internal Counters</td>
</tr>
<tr>
<td>imptcp</td>
<td>Plain TCP Syslog</td>
</tr>
<tr>
<td>imrelp</td>
<td>RELP Input Module</td>
</tr>
<tr>
<td>imsolaris</td>
<td>Solaris Input Module</td>
</tr>
<tr>
<td>imtcp</td>
<td>TCP Syslog Input Module</td>
</tr>
<tr>
<td>imudp</td>
<td>UDP Syslog Input Module</td>
</tr>
<tr>
<td>imuxsock</td>
<td>Unix Socket Input</td>
</tr>
</tbody></table>
<p><strong>Output 模块</strong>，也有许多可用的接口来实现。</p>
<p><code>Output</code> 也被称为 <code>actions</code>。 一个组操作内容都是预先加载的（比如输出文件编写器，几乎在每个 <code>rsyslog.conf</code> 中都使用）。</p>
<p>通过 action（type =“type”…）对象调用一个动作。Type 是强制性的，并且必须包含要调用的插件的名称（例如 “omfile” 或 “ommongodb”）。 其他参数可能存在。 他们的类型和使用取决于问题的输出插件。</p>
<blockquote>
<p>补充： 这些模块接口的都需要通过 <code>$ModLoad</code> 指令来加载，在下文中会为大家展示 <code>/etc/rsyslog.conf</code> 的内容，大家可以注意前两行，其意思就是默认加载了 <code>imklog</code>、<code>imuxsock</code> 这两个模块。</p>
</blockquote>
<p>在配置中 rsyslog 支持三种配置语法格式：</p>
<ul>
<li>sysklogd</li>
<li>legacy rsyslog</li>
<li>RainerScript</li>
</ul>
<p><code>sysklogd</code> 是比较老的简单格式，一些新的语法特性不支持。</p>
<p><code>legacy rsyslog</code> 是以 <code>dollar 符($)</code>开头的语法，在 v6 及以上的版本还支持，如上文所说的 <code>$ModLoad</code> 还有一些插件和特性只在此语法下支持。而以 <code>$</code> 开头的指令是全局指令，全局指令是 <code>rsyslogd</code> 守护进程的配置指令，每行只能有一个指令。</p>
<p><code>RainnerScript</code> 是最新的语法。在官网上 rsyslog 大多推荐这个语法格式来配置。</p>
<p>注：老的语法格式（<code>sysklogd &amp; legacy rsyslog</code>）是以<strong>行</strong>为单位。新的语法格式（<code>RainnerScript</code>）可以<strong>分割多行</strong>。</p>
<p>注释有两种语法:</p>
<ul>
<li>井号 <code>#</code></li>
<li>C-style<code>/* .. */</code></li>
</ul>
<p>执行顺序: 指令在 rsyslog.conf 文件中是<strong>从上到下的顺序</strong>执行的。</p>
<blockquote>
<p>对于 <code>rsyslog</code> 环境的配置文件想要深入了解的朋友可以参看一下 <a target="_blank" rel="noopener" href="http://www.rsyslog.com/doc/v8-stable/configuration/index.html">官方文档</a></p>
</blockquote>
<h6 id="配置文件内容"><a href="#配置文件内容" class="headerlink" title="配置文件内容"></a>配置文件内容</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/rsyslog.conf</span><br></pre></td></tr></table></figure>



<h5 id="rsyslog-系统日志的配置"><a href="#rsyslog-系统日志的配置" class="headerlink" title="rsyslog 系统日志的配置"></a>rsyslog 系统日志的配置</h5><p>查看系统中的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/rsyslog.d/50-default.conf </span><br></pre></td></tr></table></figure>

<p><strong>配置文件格式说明:</strong> <strong>日志设备(类型).(连接符号)日志级别 日志处理方式</strong></p>
<h6 id="日志设备-类型"><a href="#日志设备-类型" class="headerlink" title="日志设备(类型)"></a>日志设备(类型)</h6><table>
<thead>
<tr>
<th>设备</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>auth</code></td>
<td>pam 产生的日志</td>
</tr>
<tr>
<td><code>authpriv</code></td>
<td>ssh,ftp 等登录信息的验证信息，即权限系统</td>
</tr>
<tr>
<td><code>cron</code></td>
<td>时间任务相关，计划安排</td>
</tr>
<tr>
<td><code>kern</code></td>
<td>内核消息</td>
</tr>
<tr>
<td><code>lpr</code></td>
<td>打印</td>
</tr>
<tr>
<td><code>mail</code></td>
<td>邮件系统消息</td>
</tr>
<tr>
<td><code>mark(syslog)</code></td>
<td>rsyslog 服务内部的信息,时间标识</td>
</tr>
<tr>
<td><code>news</code></td>
<td>新闻组消息</td>
</tr>
<tr>
<td><code>user</code></td>
<td>用户程序产生的相关信息</td>
</tr>
<tr>
<td><code>uucp</code></td>
<td>unix 主机之间相关的通讯</td>
</tr>
<tr>
<td><code>local 1~7</code></td>
<td>自定义的日志设备</td>
</tr>
</tbody></table>
<h6 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h6><p>从上到下，日志级别由高到低，记录的信息越来越少。</p>
<table>
<thead>
<tr>
<th>priority 取值</th>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>emerge</code></td>
<td>0</td>
<td>发生严重事件，并有导致系统崩溃的潜在危险。报告软件或者硬件问题</td>
</tr>
<tr>
<td><code>alert</code></td>
<td>1</td>
<td>严重错误消息，会导致程序关闭并可能影响其他程序</td>
</tr>
<tr>
<td><code>crit</code></td>
<td>2</td>
<td>错误消息，可能会导致程序关闭的事件重</td>
</tr>
<tr>
<td><code>err</code></td>
<td>3</td>
<td>程序中存在错误的通告</td>
</tr>
<tr>
<td><code>warning</code></td>
<td>4</td>
<td>程序中存在潜在问题的警告信息</td>
</tr>
<tr>
<td><code>notice</code></td>
<td>5</td>
<td>程序运行中产生了值得注意的事件</td>
</tr>
<tr>
<td><code>info</code></td>
<td>6</td>
<td>关于程序当前状态的报告信息</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>7</td>
<td>编程人员或测试人员使用的调试信息</td>
</tr>
</tbody></table>
<blockquote>
<p>注：基本上，<code>info</code>，<code>notice</code>，<code>warn</code> 这三个讯息都是在告知一些基本信息，应该还不至于造成一些系统运作困扰。</p>
</blockquote>
<ul>
<li>优先级（priority）可参照<a target="_blank" rel="noopener" href="https://wenku.baidu.com/view/71b68835ee06eff9aef80777"> syslog 命令手册</a></li>
</ul>
<h6 id="连接符号"><a href="#连接符号" class="headerlink" title="连接符号"></a>连接符号</h6><ul>
<li><code>.xx</code> : 表示大于等于 xx 级别的信息</li>
<li><code>.=xx</code>：表示等于 xx 级别的信息</li>
<li><code>.!xx</code>：表示在 xx 之外的等级的信息</li>
</ul>
<p>可以从上面的文件中看到几项系统配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kern 的所有优先级信息异步写入 /var/log/kern.log 日志中</span></span><br><span class="line"></span><br><span class="line">kern.*      -/var/<span class="built_in">log</span>/kern.log</span><br><span class="line">：q</span><br><span class="line">(`- `代表异步写入，也就是说日志写入时不需要等待系统缓存的同步，即日志还在内存中缓存也可以继续写入无需等待完全写入硬盘后再写入。通常用于写入数据比较大时使用)</span><br></pre></td></tr></table></figure>

<p><strong>举例</strong></p>
<p>通过命令行向日志文件写入信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首先将syslog启动起来</span></span><br><span class="line">sudo service rsyslog start</span><br><span class="line"></span><br><span class="line"><span class="comment">#向 syslog 写入数据</span></span><br><span class="line">ping 127.0.0.1 | logger -it logger_test -p local3.notice &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看是否有数据写入</span></span><br><span class="line">sudo tail -f /var/<span class="built_in">log</span>/syslog</span><br></pre></td></tr></table></figure>



<h5 id="日志文件的转储"><a href="#日志文件的转储" class="headerlink" title="日志文件的转储"></a>日志文件的转储</h5><h6 id="logrotate-管理日志文件"><a href="#logrotate-管理日志文件" class="headerlink" title="logrotate 管理日志文件"></a>logrotate 管理日志文件</h6><p>在本地的机器中每天都会有成百上千条日志被写入文件中，而服务器中每天更是有数十兆甚至更多的日志信息被写入文件中，那么每天日志文件就会不断的膨胀，就会占用许多的空间，这个时候 <code>logrotate</code> 的出现正好就解决了这样一个问题。</p>
<p><code>logrotate</code> 程序是一个日志文件管理工具。用来把旧的日志文件删除，然后创建新的日志文件。可以根据日志文件的大小，也可以根据其天数来切割日志、管理日志，这个过程又叫做“转储”。</p>
<p>大多数 Linux 发行版使用 <code>logrotate</code> 或 <code>newsyslog</code>对日志进行管理。<code>logrotate</code> 程序不但可以压缩日志文件，减少存储空间，还可以将日志发送到指定 <code>E-mail</code>，方便管理员及时查看日志。</p>
<p>其中 <code>logrotate</code> 是基于 <code>CRON</code> 来运行的，脚本是 <code>/etc/cron.daily/logrotate</code>；同时配置文件在 <code>/etc/logrotate.conf</code> 和 <code>/etc/logrotate.d</code> 中找到。</p>
<p>首先，我们一起来看看 <code>/etc/logrotate.conf</code> 这个文件中的内容。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/logrotate.conf</span><br><span class="line"><span class="comment"># see &quot;man logrotate&quot; for details  //可以查看帮助文档</span></span><br><span class="line"><span class="comment"># rotate log files weekly</span></span><br><span class="line">weekly                             //设置每周转储一次(daily、weekly、monthly当然可以使用这些参数每天、星期，月 )</span><br><span class="line"><span class="comment"># keep 4 weeks worth of backlogs</span></span><br><span class="line">rotate 4                           //最多转储4次</span><br><span class="line"><span class="comment"># create new (empty) log files after rotating old ones</span></span><br><span class="line">create                             //当转储后文件不存在时创建它</span><br><span class="line"><span class="comment"># uncomment this if you want your log files compressed</span></span><br><span class="line">compress                          //通过gzip压缩方式转储（nocompress可以不压缩）</span><br><span class="line"><span class="comment"># RPM packages drop log rotation information into this directory</span></span><br><span class="line">include /etc/logrotate.d           //其他日志文件的转储方式配置文件，包含在该目录下</span><br><span class="line"><span class="comment"># no packages own wtmp -- we&#x27;ll rotate them here</span></span><br><span class="line">/var/<span class="built_in">log</span>/wtmp &#123;                    //设置/var/<span class="built_in">log</span>/wtmp日志文件的转储参数</span><br><span class="line">    monthly                        //每月转储</span><br><span class="line">    create 0664 root utmp          //转储后文件不存在时创建它，文件所有者为root，所属组为utmp，对应的权限为0664</span><br><span class="line">    rotate 1                       //最多转储一次</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="logrotate-日志转储"><a href="#logrotate-日志转储" class="headerlink" title="logrotate 日志转储"></a>logrotate 日志转储</h6><p>logrotate 的配置文件是 <code>/etc/logrotate.conf</code>，是一个只读文件，通常不需要对它进行修改。而日志文件的转储设置在独立的配置文件中，放在 <code>/etc/logrotate.d/</code>目录下。</p>
<p>我们先通过 <code>cat</code> 命令来简单查看一下实验环境中已经配置的一些文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ll /etc/logrotate.d/</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">total 40</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec 17 14:06 ./</span><br><span class="line">drwxr-xr-x 99 root root 4096 Dec 23 10:35 ../</span><br><span class="line">-rw-r--r--  1 root root  120 Nov  3  2017 alternatives</span><br><span class="line">-rw-r--r--  1 root root  126 Nov 21  2017 apport</span><br><span class="line">-rw-r--r--  1 root root  173 Apr 20  2018 apt</span><br><span class="line">-rw-r--r--  1 root root  112 Nov  3  2017 dpkg</span><br><span class="line">-rw-r--r--  1 root root  146 Jun  6  2018 lxd</span><br><span class="line">-rw-r--r--  1 root root  586 May 29  2019 rsyslog</span><br><span class="line">-rw-r--r--  1 root root  178 Aug 16  2017 ufw</span><br><span class="line">-rw-r--r--  1 root root  235 Jul 18  2018 unattended-upgrades</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/logrotate.d/apt</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/var/<span class="built_in">log</span>/apt/term.log &#123;</span><br><span class="line">  rotate 12</span><br><span class="line">  monthly</span><br><span class="line">  compress</span><br><span class="line">  missingok</span><br><span class="line">  notifempty</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/var/<span class="built_in">log</span>/apt/history.log &#123;</span><br><span class="line">  rotate 12</span><br><span class="line">  monthly</span><br><span class="line">  compress</span><br><span class="line">  missingok</span><br><span class="line">  notifempty</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>举一个例子来详细说明一下日志是如何进行转储的。</p>
<p>首先创建一个日志文件，然后快速生成文件在其中填入一个 10MB 的随机比特流数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo touch /var/<span class="built_in">log</span>/<span class="built_in">log</span>-file</span><br><span class="line">$ sudo chmod 777 /var/<span class="built_in">log</span>/<span class="built_in">log</span>-file</span><br><span class="line">$ sudo head -c 10M /dev/urandom &gt; /var/<span class="built_in">log</span>/<span class="built_in">log</span>-file</span><br></pre></td></tr></table></figure>

<p>然后，我们为这个文件创建一个配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo touch /etc/logrotate.d/<span class="built_in">log</span>-file</span><br><span class="line">$ sudo vim /etc/logrotate.d/<span class="built_in">log</span>-file</span><br><span class="line">/var/<span class="built_in">log</span>/<span class="built_in">log</span>-file &#123;</span><br><span class="line">    monthly</span><br><span class="line">    rotate 5</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    postrotate</span><br><span class="line">        /usr/bin/killall -HUP rsyslogd</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong></p>
<ul>
<li><code>monthly</code> : 日志文件按月转储。可以换成 <code>daily</code>，<code>weekly</code> 或者 <code>yearly</code> 。</li>
<li><code>rotate 5</code> : 一次转储 最近的 5 个归档日志。</li>
<li><code>compress</code> : 在转储任务完成后，已转储的日志将使用 <code>gzip</code> 进行压缩。</li>
<li><code>delaycompress</code> : 和 <code>compress</code> 选项一起使用，<code>delaycompress</code> 表示 <code>logrotate</code> 不会将最近的压缩，压缩将在下一次转储周期进行。</li>
<li><code>missingok</code> : 在日志转储的时候，任何错误将被忽略，例如“文件无法找到”之类的错误。</li>
<li><code>notifempty</code> : 如果日志文件为空，转储不会进行。</li>
<li><code>create 644 root root</code> : 以指定的权限创建全新的日志文件，同时 <code>logrotate</code> 也会重命名原始日志文件。</li>
<li><code>postrotate/endscript</code> : 在所有其它指令完成后，<code>postrotate</code> 和 <code>endscript</code> 里面指定的命令将被执行。<code>rsyslogd</code> 进程将立即再次读取其配置并继续运行。</li>
</ul>
<p><em>上面的配置比较的全面，可以当做一个模板，在实际中的配置参数根据你的需求来进行调整。</em></p>
<p>例如，当文件满足 10M 就转储一个日志文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/logrotate.d/<span class="built_in">log</span>-file</span><br><span class="line">/var/<span class="built_in">log</span>/<span class="built_in">log</span>-file&#123;</span><br><span class="line">    su root root</span><br><span class="line">    size=10M</span><br><span class="line">    rotate    5</span><br><span class="line">    create 644 root root </span><br><span class="line">    postrotate</span><br><span class="line">        /usr/bin/killall   -HUP rsyslogd</span><br><span class="line">    endscript</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置文件的开始部分 <code>su root root</code> 来指定进行转储的用户，否则会报错：“parent directory has insecure permissions (It’s world writable or writable by group which is not “root”) Set “su” directive in config file to tell logrotate which user/group should be used for rotation.”。</p>
<p>保存退出后，通过 <code>logrotate</code> 命令来调用日志。</p>
<p><strong>注：编写的配置文件的权限必须为：<code>-rw-r--r--</code> ，否则<code>logrotate</code> 就无法正常工作。执行时就会提示：<code>Ignoring mosquitto because of bad filemode</code>。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo su root</span><br><span class="line"><span class="comment"># logrotate -d /etc/logrotate.d/log-file </span></span><br></pre></td></tr></table></figure>

<p>使用 <code>-d</code> 选项是以预演方式运行 <code>logrotate</code>。不用实际转储任何日志文件，可以模拟演练日志轮循并显示其输出。</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/12/18/19-12-18-Linux-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4/" rel="prev" title="19-12-18 Linux 帮助命令">
      <i class="fa fa-chevron-left"></i> 19-12-18 Linux 帮助命令
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/01/13/20-01-13-Bash-%E5%8F%98%E9%87%8F/" rel="next" title="20-01-13 Bash 变量">
      20-01-13 Bash 变量 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zhanyeye</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  















  

  

</body>
</html>
